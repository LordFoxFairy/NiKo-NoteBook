# ç¬¬7ç«  Stable Diffusion 1.5ç»å…¸å®æˆ˜

> æŒæ¡SDç»å…¸ç‰ˆæœ¬ï¼Œä½æ˜¾å­˜ç¯å¢ƒä¹Ÿèƒ½é«˜æ•ˆç”Ÿæˆ
>
> **å­¦ä¹ ç›®æ ‡**:
> - ç†è§£SD 1.5çš„ä¼˜åŠ¿å’Œåº”ç”¨åœºæ™¯
> - æŒæ¡512åˆ†è¾¨ç‡æœ€ä½³å®è·µ
> - å­¦ä¼šæ˜¾å­˜ä¼˜åŒ–æŠ€å·§
> - ç²¾é€šLoRAå’ŒEmbeddingä½¿ç”¨

---

## 7.1 ä¸ºä»€ä¹ˆè¿˜è¦å­¦SD 1.5ï¼Ÿ

### 7.1.1 SD 1.5çš„ç‹¬ç‰¹ä»·å€¼

è™½ç„¶SDXLæ›´å…ˆè¿›ï¼Œä½†SD 1.5ä»ç„¶ä¸å¯æ›¿ä»£ï¼š

| ç»´åº¦ | SD 1.5 ä¼˜åŠ¿ | SDXL |
|------|-------------|------|
| **æ˜¾å­˜éœ€æ±‚** | 4GBå³å¯è¿è¡Œ â­â­â­â­â­ | æœ€ä½8GB |
| **ç”Ÿæˆé€Ÿåº¦** | åŸºå‡†é€Ÿåº¦ â­â­â­â­â­ | æ…¢40% |
| **ç¤¾åŒºèµ„æº** | 10ä¸‡+æ¨¡å‹ â­â­â­â­â­ | æ•°åƒæ¨¡å‹ |
| **LoRAä¸°å¯Œåº¦** | æµ·é‡LoRA â­â­â­â­â­ | è¾ƒå°‘ |
| **å¾®è°ƒæˆæœ¬** | ä½ï¼ˆ8GBæ˜¾å¡å¯è®­ç»ƒï¼‰â­â­â­â­â­ | é«˜ï¼ˆéœ€16GB+ï¼‰ |
| **ç¨³å®šæ€§** | æå…¶ç¨³å®š â­â­â­â­â­ | ç›¸å¯¹æ–° |
| **å›¾åƒè´¨é‡** | â­â­â­ | â­â­â­â­â­ |

---

### 7.1.2 æœ€ä½³åº”ç”¨åœºæ™¯

```yaml
æ¨èä½¿ç”¨SD 1.5çš„åœºæ™¯:

1. æ˜¾å­˜å—é™ â­â­â­â­â­
   - 6GBæ˜¾å¡ï¼ˆGTX 1060, RTX 2060ï¼‰
   - ç¬”è®°æœ¬GPU
   - æˆæœ¬æ§åˆ¶

2. å¿«é€ŸåŸå‹ â­â­â­â­â­
   - å¿«é€Ÿæµ‹è¯•åˆ›æ„
   - æç¤ºè¯è°ƒè¯•
   - æ¦‚å¿µéªŒè¯

3. é£æ ¼å®šåˆ¶ â­â­â­â­â­
   - æµ·é‡LoRAå¯é€‰
   - ç¤¾åŒºæ¨¡å‹ä¸°å¯Œ
   - ç‰¹å®šé£æ ¼ï¼ˆåŠ¨æ¼«ã€æ’ç”»ç­‰ï¼‰

4. æ‰¹é‡ç”Ÿäº§ â­â­â­â­
   - é€Ÿåº¦å¿« â†’ æˆæœ¬ä½
   - 512Ã—512è¶³å¤Ÿå¾ˆå¤šåœºæ™¯

5. å­¦ä¹ å…¥é—¨ â­â­â­â­â­
   - èµ„æ–™æœ€å…¨
   - æ•™ç¨‹æœ€å¤š
   - æ˜“äºç†è§£
```

---

## 7.2 SD 1.5æ¶æ„å›é¡¾

### 7.2.1 æ¨¡å‹ç»„æˆ

$$
\text{SD 1.5} = \text{U-Net}(0.86B) + \text{CLIP}(123M) + \text{VAE}(83M)
$$

æ€»å‚æ•°: **0.98B**

#### U-Netç»“æ„

```
è¾“å…¥: Latent (64Ã—64Ã—4)

Down Block 1:  320 channels
  â”œâ”€ ResBlock Ã— 2
  â””â”€ Downsample â†’ 32Ã—32

Down Block 2:  640 channels
  â”œâ”€ ResBlock Ã— 2
  â”œâ”€ Attention Ã— 1  â† Cross-Attentionå¼•å…¥
  â””â”€ Downsample â†’ 16Ã—16

Down Block 3:  1280 channels
  â”œâ”€ ResBlock Ã— 2
  â”œâ”€ Attention Ã— 1
  â””â”€ Downsample â†’ 8Ã—8

Middle Block:  1280 channels
  â”œâ”€ ResBlock Ã— 1
  â”œâ”€ Attention Ã— 1
  â””â”€ ResBlock Ã— 1

Up Block 1:    1280 channels
  â”œâ”€ Upsample â†’ 16Ã—16
  â”œâ”€ ResBlock Ã— 3
  â””â”€ Attention Ã— 1

Up Block 2:    640 channels
  â”œâ”€ Upsample â†’ 32Ã—32
  â”œâ”€ ResBlock Ã— 3
  â””â”€ Attention Ã— 1

Up Block 3:    320 channels
  â”œâ”€ Upsample â†’ 64Ã—64
  â””â”€ ResBlock Ã— 3

è¾“å‡º: Latent (64Ã—64Ã—4)
```

#### Cross-Attentionæœºåˆ¶

$$
\text{Attention}(Q, K, V) = \text{softmax}\left(\frac{QK^T}{\sqrt{d_k}}\right)V
$$

å…¶ä¸­ï¼š
- $Q = W_Q \cdot z_{\text{latent}}$ (å›¾åƒç‰¹å¾)
- $K = W_K \cdot c_{\text{text}}$ (æ–‡æœ¬ç‰¹å¾)
- $V = W_V \cdot c_{\text{text}}$

**é€šä¿—ç†è§£**: å›¾åƒçš„æ¯ä¸ªä½ç½®ï¼ˆQï¼‰å»æŸ¥è¯¢æ–‡æœ¬ï¼ˆKï¼‰ï¼Œå†³å®šå…³æ³¨å“ªäº›è¯æ±‡ï¼Œç„¶åèåˆä¿¡æ¯ï¼ˆVï¼‰ã€‚

---

### 7.2.2 CLIP Text Encoder

$$
\begin{aligned}
\text{Input} &: \text{"1 girl, fitness, gym"} \\
\text{Tokenize} &: [49406, 320, 1611, 267, 3806, 267, 2368, 49407, 0, ...] \\
&\quad\quad\quad \text{(æœ€å¤š77ä¸ªtoken)} \\
\text{Embedding} &: \mathbb{R}^{77 \times 768} \\
\text{Transformer} &: 12å±‚, 12å¤´æ³¨æ„åŠ› \\
\text{Output} &: c \in \mathbb{R}^{77 \times 768}
\end{aligned}
$$

**å…³é”®å‚æ•°**:
- è¯æ±‡è¡¨å¤§å°: 49408
- æœ€å¤§é•¿åº¦: 77 tokens
- åµŒå…¥ç»´åº¦: 768

---

## 7.3 æ¨èæ¨¡å‹ä¸‹è½½

### 7.3.1 å®˜æ–¹åŸºç¡€æ¨¡å‹

```bash
ã€SD 1.5 Baseã€‘
åç§°: v1-5-pruned-emaonly.safetensors
å¤§å°: 4.27GB
ä¸‹è½½: https://huggingface.co/runwayml/stable-diffusion-v1-5
ç”¨é€”: åŸºç¡€æ¨¡å‹ï¼Œé€šç”¨åœºæ™¯

ã€SD 1.5 Inpaintingã€‘
åç§°: sd-v1-5-inpainting.safetensors
å¤§å°: 4.27GB
ä¸‹è½½: https://huggingface.co/runwayml/stable-diffusion-inpainting
ç”¨é€”: ä¸“é—¨ç”¨äºå±€éƒ¨é‡ç»˜
```

---

### 7.3.2 ç¤¾åŒºä¼˜åŒ–æ¨¡å‹ï¼ˆçœŸäººä¸“ç”¨ï¼‰

```bash
ã€æ¨è1: Realistic Vision V5.1ã€‘â­â­â­â­â­
ä¸‹è½½: https://civitai.com/models/4201/realistic-vision-v51
æ–‡ä»¶: realisticVisionV51_v51VAE.safetensors (2.13GB)
ç‰¹ç‚¹: çœŸäººç…§ç‰‡çº§ï¼Œäºšæ´²é¢å­”ä¼˜ç§€
MD5: 15012c538f503ce2ebfc2c8547224e96

ã€æ¨è2: ChilloutMixã€‘â­â­â­â­â­
ä¸‹è½½: https://civitai.com/models/6424/chilloutmix
æ–‡ä»¶: chilloutmix_NiPrunedFp32Fix.safetensors (2.13GB)
ç‰¹ç‚¹: äºšæ´²ç¾å¥³ä¸“ç²¾ï¼Œçš®è‚¤è´¨æ„Ÿå¥½

ã€æ¨è3: MeinaMixã€‘â­â­â­â­
ä¸‹è½½: https://civitai.com/models/7240/meinamix
æ–‡ä»¶: meinamix_meinaV11.safetensors (2.13GB)
ç‰¹ç‚¹: åŠ¨æ¼«+çœŸäººæ··åˆï¼ŒäºŒæ¬¡å…ƒé£æ ¼

ã€æ¨è4: DreamShaperã€‘â­â­â­â­
ä¸‹è½½: https://civitai.com/models/4384/dreamshaper
æ–‡ä»¶: dreamshaper_8.safetensors (2.13GB)
ç‰¹ç‚¹: é€šç”¨åœºæ™¯ï¼Œå¹³è¡¡çœŸå®å’Œè‰ºæœ¯
```

---

### 7.3.3 VAEé€‰æ‹©

```bash
ã€æ¨èVAEã€‘
åç§°: vae-ft-mse-840000-ema-pruned.safetensors
å¤§å°: 335MB
ä¸‹è½½: https://huggingface.co/stabilityai/sd-vae-ft-mse-original
æ•ˆæœ: è‰²å½©æ›´é²œè‰³ï¼Œç»†èŠ‚æ›´å¥½

ä½¿ç”¨æ–¹æ³•:
WebUI â†’ Settings â†’ Stable Diffusion â†’ SD VAE
é€‰æ‹©: vae-ft-mse-840000-ema-pruned.safetensors
```

---

## 7.4 512åˆ†è¾¨ç‡æœ€ä½³å®è·µ

### 7.4.1 ä¸ºä»€ä¹ˆæ˜¯512Ã—512ï¼Ÿ

**è®­ç»ƒåˆ†è¾¨ç‡**: SD 1.5åœ¨512Ã—512åˆ†è¾¨ç‡ä¸Šè®­ç»ƒï¼Œè¿™æ˜¯**æœ€ä½³åˆ†è¾¨ç‡**ã€‚

#### åˆ†è¾¨ç‡å½±å“

$$
\text{Quality}(\text{resolution}) =
\begin{cases}
\downarrow & \text{if } resolution < 512 \text{ (æ¨¡ç³Š)} \\
\text{æœ€ä½³} & \text{if } resolution = 512 \\
\downarrow & \text{if } resolution > 512 \text{ (é‡å¤/å˜å½¢)}
\end{cases}
$$

**å®æµ‹å¯¹æ¯”**:
```python
# 384Ã—384: âŒ æ¨¡ç³Šï¼Œç»†èŠ‚ç¼ºå¤±
# 512Ã—512: âœ… æœ€ä½³è´¨é‡
# 768Ã—768: âš ï¸ å¯èƒ½å‡ºç°é‡å¤ç‰©ä½“ã€é¢å¤–è‚¢ä½“
# 1024Ã—1024: âŒ ä¸¥é‡é‡å¤é—®é¢˜
```

---

### 7.4.2 æ¨èåˆ†è¾¨ç‡è¡¨

| æ¯”ä¾‹ | åˆ†è¾¨ç‡ | ç”¨é€” | è´¨é‡ |
|------|--------|------|------|
| 1:1 | 512Ã—512 | å¤´åƒã€æ–¹å½¢å›¾ | â­â­â­â­â­ |
| 3:4 | 384Ã—512 | äººåƒçºµå‘ | â­â­â­â­â­ |
| 2:3 | 416Ã—624 | å…¨èº«çºµå‘ | â­â­â­â­ |
| 4:3 | 512Ã—384 | æ¨ªå‘åœºæ™¯ | â­â­â­â­â­ |
| 16:9 | 608Ã—342 | å®½å± | â­â­â­ |

**è§„åˆ™**:
- âš ï¸ å®½Ã—é«˜å¿…é¡»æ˜¯8çš„å€æ•°
- âš ï¸ æ€»åƒç´ å°½é‡æ¥è¿‘512Ã—512 = 262,144
- âš ï¸ é¿å…è¶…è¿‡640Ã—640

---

### 7.4.3 è¶…è¶Š512çš„æ­£ç¡®æ–¹æ³•

#### æ–¹æ³•1: Highres Fixï¼ˆæ¨èï¼‰â­â­â­â­â­

```yaml
Step 1: ç”Ÿæˆ512Ã—512åŸºç¡€å›¾
  Width: 512
  Height: 512
  Steps: 25

Step 2: Highres Fixæ”¾å¤§
  Upscaler: Latent
  Upscale by: 1.5x
  Hires steps: 15
  Denoising: 0.5

æœ€ç»ˆè¾“å‡º: 768Ã—768
```

#### æ–¹æ³•2: img2imgé‡ç»˜

```yaml
Step 1: ç”Ÿæˆ512Ã—512
Step 2: æ”¾å¤§åˆ°1024Ã—1024 (å·¥å…·æ”¾å¤§)
Step 3: img2imgé‡ç»˜
  Denoising: 0.3-0.4
  é‡ç»˜ç»†èŠ‚
```

#### æ–¹æ³•3: Tiled Diffusionï¼ˆå¤§å›¾ç”Ÿæˆï¼‰

```bash
# å®‰è£…æ’ä»¶
Extensions â†’ Install from URL
URL: https://github.com/pkuliyi2015/multidiffusion-upscaler-for-automatic1111

# ä½¿ç”¨
Script: Tiled Diffusion
Tile width: 512
Tile height: 512
Overlap: 64

å¯ç”Ÿæˆ: 2048Ã—2048+
```

---

## 7.5 æ˜¾å­˜ä¼˜åŒ–å®Œå…¨æŒ‡å—

### 7.5.1 æ˜¾å­˜å ç”¨åˆ†æ

#### ç†è®ºè®¡ç®—

$$
\begin{aligned}
\text{VRAM}_{\text{total}} &= \text{VRAM}_{\text{model}} + \text{VRAM}_{\text{compute}} \\
\text{VRAM}_{\text{model}} &= 4.27 \text{ GB (SD 1.5)} \\
\text{VRAM}_{\text{compute}} &= \frac{W \times H \times B}{65536} \times 0.5 \text{ GB}
\end{aligned}
$$

#### å®æµ‹æ•°æ®

| æ˜¾å¡ | åˆ†è¾¨ç‡ | æ— ä¼˜åŒ– | --medvram | --lowvram | --lowvram --always-batch-cond-uncond |
|------|--------|--------|-----------|-----------|--------------------------------------|
| 4GB | 512Ã—512 | âŒ OOM | âœ… 3.8GB | âœ… 3.2GB | âœ… 2.9GB |
| 6GB | 512Ã—512 | âœ… 5.2GB | âœ… 4.1GB | âœ… 3.5GB | âœ… 3.0GB |
| 6GB | 768Ã—768 | âŒ OOM | âœ… 5.8GB | âœ… 4.9GB | âœ… 4.2GB |
| 8GB | 512Ã—512 | âœ… 5.5GB | - | - | - |
| 8GB | 768Ã—768 | âœ… 7.2GB | âœ… 5.8GB | - | - |

---

### 7.5.2 å¯åŠ¨å‚æ•°ä¼˜åŒ–

#### 4GBæ˜¾å¡æé™é…ç½®

```bash
# webui-user.bat
set COMMANDLINE_ARGS=--lowvram --xformers --opt-sdp-attention --no-half-vae --precision full --always-batch-cond-uncond

# å‚æ•°è¯´æ˜:
--lowvram                      # ä½æ˜¾å­˜æ¨¡å¼ï¼ˆå¿…å¤‡ï¼‰
--xformers                     # ä½¿ç”¨xFormersåŠ é€Ÿ
--opt-sdp-attention            # PyTorch 2.0ä¼˜åŒ–
--no-half-vae                  # VAEä½¿ç”¨å…¨ç²¾åº¦ï¼ˆé¿å…é»‘å›¾ï¼‰
--precision full               # å…¨ç²¾åº¦è®¡ç®—
--always-batch-cond-uncond     # æ¡ä»¶åˆ†æ‰¹å¤„ç†ï¼ˆçœæ˜¾å­˜ï¼‰

# å¯ç”Ÿæˆåˆ†è¾¨ç‡: 512Ã—512
# é€Ÿåº¦: çº¦30ç§’/å¼  (RTX 2060)
```

#### 6GBæ˜¾å¡æ¨èé…ç½®

```bash
set COMMANDLINE_ARGS=--medvram --xformers --opt-sdp-attention

# å¯ç”Ÿæˆåˆ†è¾¨ç‡: 512Ã—768
# é€Ÿåº¦: çº¦15ç§’/å¼  (GTX 1060 6GB)
```

#### 8GBæ˜¾å¡æ¨èé…ç½®

```bash
set COMMANDLINE_ARGS=--xformers --opt-sdp-attention

# å¯ç”Ÿæˆåˆ†è¾¨ç‡: 768Ã—768
# é€Ÿåº¦: çº¦10ç§’/å¼  (RTX 2070)
```

---

### 7.5.3 å†…å­˜ä¼˜åŒ–æŠ€å·§

#### æŠ€å·§1: å¸è½½ä¸ç”¨çš„æ¨¡å‹

```python
# Settings â†’ Stable Diffusion
[âˆš] Move VAE and CLIP to RAM when training
[âˆš] Unload model from VRAM when training

æ•ˆæœ: è®­ç»ƒLoRAæ—¶èŠ‚çœ2GBæ˜¾å­˜
```

#### æŠ€å·§2: å‡å°‘æ‰¹æ¬¡å¤§å°

```yaml
# é»˜è®¤ Batch size = 1
Batch size: 1  âœ… æ¨è
Batch size: 2  âš ï¸ éœ€è¦2å€æ˜¾å­˜
```

#### æŠ€å·§3: ä½¿ç”¨åŠç²¾åº¦

```bash
# é»˜è®¤å·²å¯ç”¨ --precision autocast (fp16)
# å¦‚æœé»‘å›¾ï¼Œä½¿ç”¨:
--no-half        # å…¨ç²¾åº¦ï¼ˆè€—æ˜¾å­˜ä½†ç¨³å®šï¼‰
--no-half-vae    # VAEå…¨ç²¾åº¦ï¼ˆæ¨èï¼‰
```

---

## 7.6 LoRAæ·±åº¦åº”ç”¨

### 7.6.1 LoRAåŸç†å›é¡¾

#### æ•°å­¦åŸºç¡€

åŸå§‹æ¨¡å‹æƒé‡æ›´æ–°ï¼š
$$
W \in \mathbb{R}^{d \times k}, \quad \Delta W = W_{\text{fine-tuned}} - W_{\text{base}}
$$

LoRAä½ç§©åˆ†è§£ï¼š
$$
\Delta W \approx B \cdot A
$$

å…¶ä¸­ï¼š
- $B \in \mathbb{R}^{d \times r}$
- $A \in \mathbb{R}^{r \times k}$
- $r \ll \min(d, k)$ (é€šå¸¸ $r=4, 8, 16$)

**å‚æ•°é‡å¯¹æ¯”**:
$$
\begin{aligned}
\text{Full fine-tuning} &: d \times k \text{ å‚æ•°} \\
\text{LoRA} &: (d + k) \times r \text{ å‚æ•°} \\
\text{å‹ç¼©æ¯”} &: \frac{d \times k}{(d+k) \times r} \approx \frac{\min(d,k)}{2r}
\end{aligned}
$$

ç¤ºä¾‹ ($d=k=1024, r=8$):
$$
\text{å‹ç¼©æ¯”} = \frac{1024 \times 1024}{(1024+1024) \times 8} = \frac{1,048,576}{16,384} = 64\text{å€}
$$

---

### 7.6.2 LoRAä¸‹è½½ä¸ä½¿ç”¨

#### æ¨èLoRAï¼ˆçœŸäººå¥èº«ï¼‰

```bash
ã€å¥èº«/è‚Œè‚‰é£æ ¼LoRAã€‘
åç§°: Fitness_LoRA_v1
ä¸‹è½½: https://civitai.com/models/82098/fitness-style
æ–‡ä»¶: fitness_style_v1.safetensors (144MB)
æƒé‡: 0.6-0.8

ã€éŸ©ç³»ç¾å¥³LoRAã€‘
åç§°: Korean Doll Likeness
ä¸‹è½½: https://civitai.com/models/26124/korean-doll-likeness
æ–‡ä»¶: koreanDollLikeness_v20.safetensors (151MB)
æƒé‡: 0.5-0.7

ã€è‚Œè‚‰çº¿æ¡å¢å¼ºLoRAã€‘
åç§°: Muscular Female
ä¸‹è½½: https://civitai.com/models/31285/muscular-female
æ–‡ä»¶: muscularFemale_v10.safetensors (75MB)
æƒé‡: 0.4-0.6

ã€å†™å®é£æ ¼LoRAã€‘
åç§°: Detail Tweaker LoRA
ä¸‹è½½: https://civitai.com/models/58390/detail-tweaker-lora
æ–‡ä»¶: add_detail.safetensors (75MB)
æƒé‡: 0.5-1.0
```

---

### 7.6.3 LoRAä½¿ç”¨æŠ€å·§

#### WebUIä½¿ç”¨æ–¹æ³•

```
æ–¹æ³•1: æç¤ºè¯ä¸­ä½¿ç”¨
<lora:fitness_style_v1:0.8>

æ–¹æ³•2: é¢å¤–ç½‘ç»œé¢æ¿
ç‚¹å‡» "Show extra networks"
é€‰æ‹© LoRA æ ‡ç­¾
ç‚¹å‡»éœ€è¦çš„LoRA

å®Œæ•´æç¤ºè¯ç¤ºä¾‹:
<lora:fitness_style_v1:0.8> <lora:add_detail:0.6>
masterpiece, 1 girl, athletic body, toned abs,
sports bra, yoga pants, gym,
professional photography, highly detailed
```

#### æƒé‡è°ƒæ•´æŠ€å·§

```python
# æƒé‡å€¼å½±å“

0.3: è½»å¾®å½±å“ï¼ˆsubtleï¼‰
  â””â†’ é€‚åˆ: å¾®è°ƒé£æ ¼

0.5-0.7: æ ‡å‡†ä½¿ç”¨ï¼ˆbalancedï¼‰â­â­â­â­â­
  â””â†’ é€‚åˆ: å¤§å¤šæ•°åœºæ™¯

0.8-1.0: å¼ºçƒˆå½±å“ï¼ˆstrongï¼‰
  â””â†’ é€‚åˆ: ä¸»å¯¼é£æ ¼

1.2+: è¿‡åº¦å½±å“ï¼ˆoverpoweredï¼‰
  â””â†’ å¯èƒ½å¤±çœŸï¼Œä¸æ¨è

è´Ÿæƒé‡: -0.5
  â””â†’ åå‘å½±å“ï¼ˆç§»é™¤æŸäº›ç‰¹å¾ï¼‰
```

#### å¤šLoRAç»„åˆ

```
ã€ç»„åˆ1: çœŸå®æ„Ÿ + ç»†èŠ‚ã€‘
<lora:realisticVision:0.7> <lora:add_detail:0.5>

ã€ç»„åˆ2: å¥èº«é£æ ¼ + éŸ©ç³»ç¾å¥³ã€‘
<lora:fitness_style:0.6> <lora:koreanDoll:0.5>

ã€ç»„åˆ3: è‚Œè‚‰ + å…‰å½±ã€‘
<lora:muscular:0.5> <lora:cinematic_lighting:0.6>

æ³¨æ„:
- æœ€å¤š3-4ä¸ªLoRA
- æ€»æƒé‡å’Œ < 3.0
- é¿å…å†²çªLoRA
```

---

### 7.6.4 LoRAè®­ç»ƒå…¥é—¨

#### å¿«é€Ÿè®­ç»ƒæµç¨‹

```yaml
ã€å‡†å¤‡æ•°æ®ã€‘
æ•°é‡: 20-100å¼ å›¾åƒ
è¦æ±‚:
  - åŒä¸€ä¸»é¢˜/é£æ ¼
  - é«˜è´¨é‡
  - 512Ã—512åˆ†è¾¨ç‡
  - æ ¼å¼: JPG/PNG

ã€ä½¿ç”¨Kohya_ss GUIã€‘
ä¸‹è½½: https://github.com/bmaltais/kohya_ss
å®‰è£…: ä¸€é”®å®‰è£…åŒ…

è®­ç»ƒå‚æ•°:
  Model: v1-5-pruned-emaonly.safetensors
  Resolution: 512Ã—512
  Batch size: 1
  Epochs: 10-20
  Learning rate: 1e-4
  Network dim: 8 (rank)
  Network alpha: 4

æ˜¾å­˜éœ€æ±‚: 8GB (--lowvramå¯é™è‡³6GB)
æ—¶é—´: 20å¼ å›¾ Ã— 10 epochs â‰ˆ 30åˆ†é’Ÿ (RTX 3060)
```

#### è®­ç»ƒè„šæœ¬ç¤ºä¾‹

```bash
# train_lora.sh
python train_network.py \
  --pretrained_model_name_or_path="models/v1-5-pruned-emaonly.safetensors" \
  --train_data_dir="datasets/fitness_style" \
  --output_dir="output/loras" \
  --output_name="my_fitness_lora" \
  --resolution=512 \
  --train_batch_size=1 \
  --learning_rate=1e-4 \
  --max_train_epochs=15 \
  --network_module=networks.lora \
  --network_dim=8 \
  --network_alpha=4 \
  --enable_bucket \
  --min_bucket_reso=256 \
  --max_bucket_reso=1024 \
  --xformers \
  --mixed_precision="fp16" \
  --cache_latents \
  --optimizer_type="AdamW8bit"
```

---

## 7.7 Textual Inversion (Embedding)

### 7.7.1 åŸç†

#### ä¸LoRAçš„åŒºåˆ«

```
LoRA: ä¿®æ”¹æ¨¡å‹æƒé‡
  W_new = W_base + Î±Â·Î”W

Textual Inversion: å­¦ä¹ æ–°tokençš„embedding
  E_new["my_token"] = ä¼˜åŒ–åçš„å‘é‡
```

**æ•°å­¦è¡¨ç¤º**:

$$
\begin{aligned}
\text{æ–°è¯} &: \text{"fitness\_girl\_style"} \\
\text{æ˜ å°„åˆ°} &: v^* \in \mathbb{R}^{768} \\
\text{ä¼˜åŒ–ç›®æ ‡} &: \min_{v^*} \mathcal{L}(x, c) \quad \text{where } c = \text{CLIP}(v^*)
\end{aligned}
$$

---

### 7.7.2 æ¨èEmbedding

```bash
ã€è´Ÿé¢Embedding - å¿…å¤‡ã€‘â­â­â­â­â­
åç§°: EasyNegative
ä¸‹è½½: https://civitai.com/models/7808/easynegative
æ–‡ä»¶: EasyNegative.safetensors (25KB)
ç”¨æ³•: Negative promptä¸­æ·»åŠ  "EasyNegative"

æ•ˆæœ: è‡ªåŠ¨é¿å…å¸¸è§é—®é¢˜ï¼ˆdeformed, ugly, bad handsç­‰ï¼‰

ã€è´Ÿé¢Embedding - è¿›é˜¶ã€‘
åç§°: bad-hands-5
ä¸‹è½½: https://huggingface.co/yesyeahvh/bad-hands-5
æ–‡ä»¶: bad-hands-5.pt (37KB)
ç”¨æ³•: Negativeä¸­æ·»åŠ  "bad-hands-5"

ã€é£æ ¼Embeddingã€‘
åç§°: Style-Nebula
ä¸‹è½½: https://civitai.com/models/72437/style-nebula
ç”¨æ³•: Positiveä¸­æ·»åŠ  "style-nebula"
```

---

### 7.7.3 ä½¿ç”¨æ–¹æ³•

```
ã€WebUIä¸­ä½¿ç”¨ã€‘
1. ä¸‹è½½.ptæˆ–.safetensorsæ–‡ä»¶
2. æ”¾å…¥: embeddings/ç›®å½•
3. é‡å¯WebUIæˆ–ç‚¹å‡»åˆ·æ–°

4. åœ¨æç¤ºè¯ä¸­ä½¿ç”¨:
   Positive: fitness_style_embedding
   Negative: EasyNegative, bad-hands-5

ã€å®Œæ•´ç¤ºä¾‹ã€‘
Positive:
masterpiece, best quality,
1 girl, athletic body, gym,
professional photography

Negative:
EasyNegative, bad-hands-5,
(low quality, blurry:1.4)

æ•ˆæœ: Embeddingè‡ªåŠ¨å¤„ç†å¸¸è§é—®é¢˜
```

---

## 7.8 å®æˆ˜é¡¹ç›®ï¼š512é«˜è´¨é‡äººåƒ

### 7.8.1 å®Œæ•´é…ç½®

```yaml
ã€æ¨¡å‹é€‰æ‹©ã€‘
Checkpoint: realisticVisionV51_v51VAE.safetensors
VAE: å†…ç½®ï¼ˆå·²bakeï¼‰
LoRA:
  - <lora:add_detail:0.6>
Embedding:
  - Negative: EasyNegative

ã€æç¤ºè¯ã€‘
Positive:
masterpiece, best quality, ultra detailed,
RAW photo, professional photography,
<lora:add_detail:0.6>
1 girl, 25 years old, asian woman,
(athletic physique:1.3), (toned abs:1.2),
beautiful face, detailed eyes, natural skin,
long black hair, ponytail,
(sports bra:1.2), (yoga pants:1.2),
standing in modern gym,
natural window lighting, soft shadows,
depth of field, bokeh,
photorealistic, highly detailed skin texture

Negative:
EasyNegative, bad-hands-5,
(deformed, ugly, bad anatomy:1.4),
(bad hands, bad fingers:1.4),
(low quality, worst quality, blurry:1.4),
watermark, text, signature

ã€é‡‡æ ·å‚æ•°ã€‘
Sampling method: DPM++ 2M Karras
Sampling steps: 30
Width: 384
Height: 512  (3:4äººåƒæ¯”ä¾‹)
CFG Scale: 7
Seed: 123456 (å›ºå®šå¯å¤ç°)
Clip skip: 2

ã€Highres Fixã€‘
[âˆš] Enable
Upscaler: Latent
Hires steps: 20
Denoising strength: 0.5
Upscale by: 2

æœ€ç»ˆè¾“å‡º: 768Ã—1024
```

---

### 7.8.2 ç”Ÿæˆæ•ˆæœé¢„æœŸ

```
è´¨é‡æŒ‡æ ‡:

åˆ†è¾¨ç‡: 768Ã—1024 âœ…
äººç‰©: å•äººï¼Œäºšæ´²å¥³æ€§ âœ…
èº«æ: å¥ç¾èº«æï¼Œè…¹è‚Œæ˜æ˜¾ âœ…
æœè£…: è¿åŠ¨å†…è¡£ï¼Œç‘œä¼½è£¤ âœ…
ç¯å¢ƒ: ç°ä»£å¥èº«æˆ¿ âœ…
å…‰çº¿: è‡ªç„¶çª—å…‰ âœ…
ç»†èŠ‚: çš®è‚¤çº¹ç†æ¸…æ™° âœ…
æ‰‹éƒ¨: æ­£å¸¸ï¼ˆé¿å…å¤šä½™æ‰‹æŒ‡ï¼‰âœ…

ç”Ÿæˆæ—¶é—´:
RTX 2060: çº¦45ç§’
RTX 3060: çº¦30ç§’
RTX 4060: çº¦20ç§’
```

---

## 7.9 å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1: é»‘å›¾/çº¯è‰²è¾“å‡º

**åŸå› **: VAEç²¾åº¦é—®é¢˜

**è§£å†³**:
```bash
# æ–¹æ³•1: æ·»åŠ å¯åŠ¨å‚æ•°
--no-half-vae

# æ–¹æ³•2: æ›´æ¢VAE
ä¸‹è½½: vae-ft-mse-840000-ema-pruned.safetensors
Settings â†’ SD VAE â†’ é€‰æ‹©æ–°VAE
```

---

### é—®é¢˜2: 512ä»¥ä¸Šåˆ†è¾¨ç‡é‡å¤

**åŸå› **: è¶…å‡ºè®­ç»ƒåˆ†è¾¨ç‡

**è§£å†³**:
```yaml
# ä¸è¦ç›´æ¥ç”Ÿæˆ768Ã—768
# ä½¿ç”¨Highres Fix:
Step 1: 512Ã—512
Step 2: Highres Fix â†’ 768Ã—768
```

---

### é—®é¢˜3: æ˜¾å­˜ä¸è¶³ (OOM)

**åŸå› **: æ˜¾å­˜é…ç½®ä¸å¤Ÿ

**è§£å†³**:
```bash
# 4GBæ˜¾å¡
set COMMANDLINE_ARGS=--lowvram --xformers --no-half-vae

# 6GBæ˜¾å¡
set COMMANDLINE_ARGS=--medvram --xformers

# é™ä½åˆ†è¾¨ç‡
768Ã—768 â†’ 512Ã—512
```

---

### é—®é¢˜4: LoRAä¸ç”Ÿæ•ˆ

**æ£€æŸ¥æ¸…å•**:
```
â–¡ LoRAæ–‡ä»¶åœ¨ models/Lora/ ç›®å½•?
â–¡ æç¤ºè¯è¯­æ³•æ­£ç¡®? <lora:name:weight>
â–¡ LoRAä¸Checkpointå…¼å®¹?ï¼ˆSD1.5 LoRAä¸èƒ½ç”¨äºSDXLï¼‰
â–¡ æƒé‡æ˜¯å¦åˆé€‚? (æ¨è0.5-0.8)
â–¡ æ˜¯å¦åˆ·æ–°äº†é¢å¤–ç½‘ç»œ?
```

---

## 7.10 SD 1.5 vs SDXL é€‰æ‹©æŒ‡å—

### å†³ç­–çŸ©é˜µ

| éœ€æ±‚ | æ¨èæ¨¡å‹ | åŸå›  |
|------|---------|------|
| **æ˜¾å¡4-6GB** | SD 1.5 â­â­â­â­â­ | SDXLæ— æ³•è¿è¡Œ |
| **å¿«é€Ÿæµ‹è¯•** | SD 1.5 â­â­â­â­â­ | é€Ÿåº¦å¿«2å€ |
| **å°åˆ†è¾¨ç‡(<768)** | SD 1.5 â­â­â­â­â­ | 512Ã—512æœ€ä½³ |
| **åŠ¨æ¼«/æ’ç”»** | SD 1.5 â­â­â­â­â­ | ç¤¾åŒºæ¨¡å‹ä¸°å¯Œ |
| **çœŸäººç…§ç‰‡** | SDXL â­â­â­â­â­ | è´¨é‡æ˜¾è‘—æ›´å¥½ |
| **é«˜åˆ†è¾¨ç‡(1024+)** | SDXL â­â­â­â­â­ | åŸç”Ÿæ”¯æŒ |
| **ç»†èŠ‚çº¹ç†** | SDXL â­â­â­â­â­ | çš®è‚¤ç­‰ç»†èŠ‚æ›´å¥½ |
| **é£æ ¼LoRA** | SD 1.5 â­â­â­â­â­ | é€‰æ‹©æ›´å¤š |

---

## 7.11 æœ¬ç« æ€»ç»“

### æ ¸å¿ƒçŸ¥è¯†ç‚¹

```
âœ… SD 1.5æ¶æ„ä¸ä¼˜åŠ¿
âœ… 512åˆ†è¾¨ç‡æœ€ä½³å®è·µ
âœ… æ˜¾å­˜ä¼˜åŒ–å®Œå…¨æŒ‡å—ï¼ˆ4GBå¯ç”¨ï¼‰
âœ… LoRAæ·±åº¦åº”ç”¨
âœ… Textual Inversionä½¿ç”¨
âœ… é«˜è´¨é‡äººåƒç”Ÿæˆ
```

### é»„é‡‘é…ç½®ï¼ˆ6GBæ˜¾å¡ï¼‰

```yaml
å¯åŠ¨å‚æ•°:
  --medvram --xformers --opt-sdp-attention

æ¨¡å‹:
  Checkpoint: realisticVisionV51
  LoRA: add_detail (0.6)
  Embedding: EasyNegative

å‚æ•°:
  åˆ†è¾¨ç‡: 384Ã—512
  æ­¥æ•°: 30
  é‡‡æ ·å™¨: DPM++ 2M Karras
  CFG: 7

Highres Fix:
  æ”¾å¤§: 2x
  æœ€ç»ˆ: 768Ã—1024
```

### å®æˆ˜æ£€æŸ¥æ¸…å•

- [ ] ä¸‹è½½SD 1.5æ¨¡å‹å’ŒVAE
- [ ] é…ç½®æ˜¾å­˜ä¼˜åŒ–å‚æ•°
- [ ] ä¸‹è½½æ¨èLoRA
- [ ] ä¸‹è½½EasyNegative Embedding
- [ ] ç”Ÿæˆç¬¬ä¸€å¼ 512Ã—512å›¾åƒ
- [ ] ä½¿ç”¨Highres Fixæ”¾å¤§åˆ°768Ã—1024
- [ ] æµ‹è¯•LoRAç»„åˆæ•ˆæœ

---

## 7.12 ä¸‹ä¸€æ­¥

**æœ¬ç« å®Œæˆåï¼Œä½ åº”è¯¥èƒ½å¤Ÿ**:
- âœ… åœ¨ä½æ˜¾å­˜ç¯å¢ƒç”Ÿæˆé«˜è´¨é‡å›¾åƒ
- âœ… ç†Ÿç»ƒä½¿ç”¨LoRAå’ŒEmbedding
- âœ… æŒæ¡512åˆ†è¾¨ç‡æœ€ä½³å®è·µ
- âœ… ä¼˜åŒ–æ˜¾å­˜å’Œæ€§èƒ½

**ä¸‹ä¸€ç« é¢„å‘Š**:
å­¦ä¹ Flux.1 - 2024å¹´æœ€å¼ºçœŸå®æ„Ÿæ¨¡å‹ï¼Œ4æ­¥å³å¯ç”Ÿæˆç…§ç‰‡çº§å›¾åƒï¼

**ä¸‹ä¸€ç« **: [ç¬¬8ç«  Flux.1å®Œå…¨ç²¾é€š](../ç¬¬08ç« _Fluxå®æˆ˜/README.md)

---

**èµ„æºä¸‹è½½**:
- ğŸ“¥ SD 1.5æ¨èæ¨¡å‹åˆ—è¡¨
- ğŸ“¥ LoRAåˆé›†ï¼ˆå¥èº«/çœŸäººï¼‰
- ğŸ“¥ Embeddingåˆé›†

**ä¿å­˜ä½ç½®**: `/tmp/AIGCå†…å®¹ç”Ÿæˆèµ„æº/SD1.5/`

# ç¬¬9ç«  å›¾åƒç”Ÿæˆ(å…­) Stable Diffusion 3.5æ–°æ¶æ„å®æˆ˜

> **å­¦ä¹ ç›®æ ‡**: æŒæ¡SD 3.5çš„MMDiTæ¶æ„ã€ä¸‰ç‰ˆæœ¬å·®å¼‚ã€æ–‡å­—æ¸²æŸ“èƒ½åŠ›åŠå•†ä¸šåº”ç”¨
>
> **éš¾åº¦**: â­â­â­
> **å­¦ä¹ å‘¨æœŸ**: 2-3å¤©
> **æ¨èåº¦**: â­â­â­â­

---

## 9.1 SD 3.5å…¨æ™¯æ¦‚è§ˆ

### 9.1.1 ä¸ºä»€ä¹ˆéœ€è¦SD 3.5?

**SDXLçš„å±€é™æ€§**:
- æ–‡å­—æ¸²æŸ“èƒ½åŠ›å¼±(åªèƒ½ç®€å•è‹±æ–‡)
- æç¤ºè¯ç†è§£ä¸å¤Ÿç²¾å‡†
- å¤æ‚æ„å›¾èƒ½åŠ›æ¬ ç¼º

**Flux.1çš„æŒ‘æˆ˜**:
- 12Bå‚æ•°å¯¹ç¡¬ä»¶è¦æ±‚é«˜(24GB+ VRAM)
- å•†ä¸šæˆæƒä¸æ˜ç¡®
- ç¤¾åŒºç”Ÿæ€å°šæœªæˆç†Ÿ

**SD 3.5çš„å®šä½**:
```
SD 3.5 = SDXLçš„è´¨é‡æå‡ + Fluxçš„åˆ›æ–°æŠ€æœ¯ + å•†ä¸šå‹å¥½æˆæƒ
```

### 9.1.2 ä¸‰ç‰ˆæœ¬å®Œæ•´å¯¹æ¯”

| ç‰¹æ€§ | **SD 3.5 Large** | **SD 3.5 Large Turbo** | **SD 3.5 Medium** |
|------|------------------|------------------------|-------------------|
| **å‚æ•°é‡** | 8.1B | 8.1B (è’¸é¦ç‰ˆ) | 2.5B |
| **VRAM** | ~15GB | ~15GB | ~10GB (ä»…æ¨¡å‹9.9GB) |
| **æ¨ç†æ­¥æ•°** | 30-50æ­¥ | 4-8æ­¥ | 30-50æ­¥ |
| **åˆ†è¾¨ç‡èŒƒå›´** | 1024Ã—1024 (1MP) | 1024Ã—1024 (1MP) | 512Ã—512 ~ 1448Ã—1448 (0.25-2MP) |
| **ç”Ÿæˆé€Ÿåº¦** | æ…¢ (~20s/å¼ ) | **æå¿«** (~4s/å¼ ) | ä¸­ (~10s/å¼ ) |
| **å›¾åƒè´¨é‡** | â­â­â­â­â­ | â­â­â­â­ | â­â­â­â­ |
| **æç¤ºè¯ç†è§£** | æœ€å¼º | å¼º | å¼º |
| **æ–‡å­—æ¸²æŸ“** | ä¼˜ç§€ | ä¼˜ç§€ | è‰¯å¥½ |
| **é€‚ç”¨åœºæ™¯** | ä¸“ä¸šåˆ›ä½œã€å•†ä¸šé¡¹ç›® | æ‰¹é‡ç”Ÿäº§ã€å¿«é€ŸåŸå‹ | ä¸ªäººåˆ›ä½œã€ä½æˆæœ¬éƒ¨ç½² |
| **ç¡¬ä»¶è¦æ±‚** | RTX 4090 24GB | RTX 4090 24GB | RTX 4060 Ti 16GB |

**é€‰æ‹©å»ºè®®**:
```python
def choose_sd35_version(scenario):
    """SD 3.5ç‰ˆæœ¬é€‰æ‹©å†³ç­–æ ‘"""
    if scenario == "è´¨é‡ç¬¬ä¸€,ä¸è®¡æˆæœ¬":
        return "SD 3.5 Large"
    elif scenario == "æ‰¹é‡ç”Ÿäº§,é€Ÿåº¦ä¼˜å…ˆ":
        return "SD 3.5 Large Turbo"
    elif scenario == "ä¸ªäººåˆ›ä½œ,é¢„ç®—æœ‰é™":
        return "SD 3.5 Medium"
    elif scenario == "å•†ä¸šæˆæƒ<$1Mè¥æ”¶":
        return "ä»»æ„ç‰ˆæœ¬(å…è´¹å•†ç”¨)"
    else:
        return "SD 3.5 Large Turbo (æ€§ä»·æ¯”æœ€é«˜)"
```

### 9.1.3 vs SDXL/FluxæŠ€æœ¯å¯¹æ¯”

| ç»´åº¦ | SDXL | SD 3.5 Large | Flux.1 Dev |
|------|------|--------------|------------|
| **æ¶æ„** | U-Net + Dual CLIP | MMDiT-X + 3 Text Encoders | DiT + Flow Matching |
| **å‚æ•°é‡** | 3.5B | 8.1B | 12B |
| **æç¤ºè¯ç†è§£** | â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ |
| **æ–‡å­—æ¸²æŸ“** | âŒ (å‡ ä¹ä¸èƒ½) | âœ… (ä¼˜ç§€) | âœ… (å®Œç¾) |
| **æ‰‹éƒ¨ç»†èŠ‚** | â­â­ | â­â­â­â­ | â­â­â­â­â­ |
| **å¤æ‚æ„å›¾** | â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ |
| **ç¤¾åŒºç”Ÿæ€** | â­â­â­â­â­ (æœ€æˆç†Ÿ) | â­â­â­ (æˆé•¿ä¸­) | â­â­ (è¾ƒæ–°) |
| **å•†ä¸šæˆæƒ** | å¼€æºå‹å¥½ | **æ˜ç¡®å•†ç”¨è®¸å¯** | éœ€ä»˜è´¹æˆæƒ |
| **ç¡¬ä»¶å‹å¥½åº¦** | é«˜ (12GBå¯ç”¨) | ä¸­ (16GBèµ·) | ä½ (24GBèµ·) |

**å…³é”®æŠ€æœ¯çªç ´**:

1. **MMDiT-Xæ¶æ„** (Multimodal Diffusion Transformer - eXtended)
   - å¤šæ¨¡æ€èåˆ: 3ä¸ªæ–‡æœ¬ç¼–ç å™¨(CLIP L/14, CLIP G/14, T5-XXL)
   - Query-Key Normalization: ç¨³å®šè®­ç»ƒ,ç®€åŒ–å¾®è°ƒ

2. **æ”¹è¿›çš„è®­ç»ƒæ–¹æ³•**
   - æ›´å¤§è§„æ¨¡æ•°æ®é›†
   - æ›´ç²¾å‡†çš„æ ‡æ³¨
   - å¤šåˆ†è¾¨ç‡è®­ç»ƒç­–ç•¥

3. **çµæ´»çš„è¾“å‡ºå¤šæ ·æ€§**
   ```
   è®¾è®¡å“²å­¦: ä¿ç•™çŸ¥è¯†å¹¿åº¦ > è¿‡åº¦ç¡®å®šæ€§

   åŒä¸€æç¤ºè¯ + ä¸åŒseed = æ›´ä¸°å¯Œçš„é£æ ¼å˜åŒ–
   (è¿™æ˜¯ç‰¹æ€§,ä¸æ˜¯bug!)
   ```

---

## 9.2 MMDiT-Xæ¶æ„æ·±åº¦è§£æ

### 9.2.1 æ¶æ„æ¼”è¿›è·¯çº¿

```
SD 1.5 (U-Net)
    â†“
SDXL (U-Net + Dual CLIP)
    â†“
SD 3.0 (MMDiTåˆç‰ˆ)
    â†“
SD 3.5 (MMDiT-X + QK Normalization)
```

### 9.2.2 æ ¸å¿ƒç»„ä»¶è¯¦è§£

**1. ä¸‰æ–‡æœ¬ç¼–ç å™¨æ¶æ„**

```python
"""
SD 3.5ä½¿ç”¨3ä¸ªæ–‡æœ¬ç¼–ç å™¨å¹¶è¡Œå¤„ç†æç¤ºè¯:
"""

# ä¼ªä»£ç æ¼”ç¤º
class SD35TextEncoder:
    def __init__(self):
        self.clip_l = CLIPTextModel("openai/clip-vit-large-patch14")  # ç†è§£è§†è§‰æ¦‚å¿µ
        self.clip_g = CLIPTextModel("laion/CLIP-ViT-bigG-14")        # ç†è§£è¯­ä¹‰å…³ç³»
        self.t5_xxl = T5Model("google/t5-v1_1-xxl")                  # ç†è§£å¤æ‚è¯­æ³•

    def encode(self, prompt):
        # å¹¶è¡Œç¼–ç 
        clip_l_emb = self.clip_l.encode(prompt)    # 768ç»´
        clip_g_emb = self.clip_g.encode(prompt)    # 1280ç»´
        t5_emb = self.t5_xxl.encode(prompt)        # 4096ç»´

        # èåˆç­–ç•¥
        combined_emb = self.fuse([clip_l_emb, clip_g_emb, t5_emb])
        return combined_emb
```

**ä¸ºä»€ä¹ˆéœ€è¦3ä¸ªç¼–ç å™¨?**
- **CLIP-L**: æ“…é•¿ç†è§£è§†è§‰å±æ€§(é¢œè‰²ã€å½¢çŠ¶ã€é£æ ¼)
- **CLIP-G**: æ“…é•¿ç†è§£ç‰©ä½“å…³ç³»å’Œè¯­ä¹‰
- **T5-XXL**: æ“…é•¿ç†è§£å¤æ‚è¯­æ³•å’Œé•¿å¥å­

**å®é™…æ•ˆæœå¯¹æ¯”**:
```
æç¤ºè¯: "A futuristic cityscape at sunset with flying cars and neon signs displaying 'WELCOME'"

SDXL (Dual CLIP):
- èƒ½ç”Ÿæˆæœªæ¥åŸå¸‚å’Œé£è½¦
- éœ“è™¹ç¯æ ‡è¯†å¤§æ¦‚ç‡ä¹±ç 
- æ—¥è½æ°›å›´å¯èƒ½ä¸å‡†ç¡®

SD 3.5 (3ç¼–ç å™¨):
- ç²¾å‡†ç†è§£"æœªæ¥"+"æ—¥è½"çš„ç»„åˆ
- "WELCOME"æ–‡å­—æ¸…æ™°å¯è¯»
- é£è½¦ä¸éœ“è™¹ç¯ç©ºé—´å…³ç³»æ­£ç¡®
```

**2. Query-Key Normalizationè¯¦è§£**

ä¼ ç»ŸTransformerçš„Attentionè®¡ç®—:
$$
\text{Attention}(Q, K, V) = \text{softmax}\left(\frac{QK^T}{\sqrt{d_k}}\right)V
$$

SD 3.5å¢å¼ºç‰ˆ(QK Normalization):
$$
\text{Attention}(Q, K, V) = \text{softmax}\left(\frac{\text{Norm}(Q) \cdot \text{Norm}(K)^T}{\tau}\right)V
$$

å…¶ä¸­:
- $\text{Norm}(x) = \frac{x}{\|x\|_2}$ (L2å½’ä¸€åŒ–)
- $\tau$ æ˜¯å¯å­¦ä¹ çš„æ¸©åº¦å‚æ•°

**ä¼˜åŠ¿**:
1. **è®­ç»ƒç¨³å®šæ€§æå‡**: æ¢¯åº¦ä¸ä¼šå› å‘é‡é•¿åº¦çˆ†ç‚¸
2. **å¾®è°ƒæ›´å®¹æ˜“**: ä¸éœ€è¦é‡æ–°è°ƒæ•´å­¦ä¹ ç‡
3. **æ¨ç†ä¸€è‡´æ€§**: ç›¸åŒæç¤ºè¯çš„è¾“å‡ºæ›´ç¨³å®š

**3. MMDiT-X Transformer Block**

```python
class MMDiTBlock:
    """SD 3.5çš„æ ¸å¿ƒTransformerå—"""

    def forward(self, x_img, x_text):
        """
        x_img: å›¾åƒlatentç‰¹å¾ (B, H*W, D)
        x_text: æ–‡æœ¬embedding (B, L, D)
        """
        # 1. Multi-Head Self-Attention (å›¾åƒè‡ªæ³¨æ„åŠ›)
        q_img = self.to_q_img(x_img)
        k_img = self.to_k_img(x_img)
        v_img = self.to_v_img(x_img)

        # QK Normalization
        q_img = F.normalize(q_img, dim=-1)
        k_img = F.normalize(k_img, dim=-1)

        attn_img = softmax(q_img @ k_img.T / self.temperature) @ v_img

        # 2. Cross-Attention (å›¾åƒ-æ–‡æœ¬äº¤äº’)
        q_img_text = self.to_q_cross(x_img)
        k_text = self.to_k_cross(x_text)
        v_text = self.to_v_cross(x_text)

        q_img_text = F.normalize(q_img_text, dim=-1)
        k_text = F.normalize(k_text, dim=-1)

        attn_cross = softmax(q_img_text @ k_text.T / self.temperature) @ v_text

        # 3. Feed-Forward Network
        x_img = x_img + attn_img + attn_cross
        x_img = x_img + self.ffn(x_img)

        return x_img
```

### 9.2.3 å‰å‘æ¨ç†æµç¨‹

```mermaid
graph TB
    A[è¾“å…¥æç¤ºè¯] --> B[CLIP-Lç¼–ç ]
    A --> C[CLIP-Gç¼–ç ]
    A --> D[T5-XXLç¼–ç ]
    B --> E[èåˆæ–‡æœ¬Embedding]
    C --> E
    D --> E
    F[éšæœºå™ªå£°] --> G[VAE Encoder]
    G --> H[Latent Space å™ªå£°]
    E --> I[MMDiT-X Transformer]
    H --> I
    I --> J{æ‰©æ•£æ­¥éª¤ < N?}
    J -->|æ˜¯| K[å»å™ªé¢„æµ‹]
    K --> L[æ›´æ–°Latent]
    L --> I
    J -->|å¦| M[VAE Decoder]
    M --> N[æœ€ç»ˆå›¾åƒ]
```

**å…³é”®å‚æ•°**:
- Latentç»´åº¦: 128Ã—128Ã—16 (å¯¹äº1024Ã—1024å›¾åƒ)
- Transformerå±‚æ•°: 38å±‚ (Largeç‰ˆæœ¬)
- æ³¨æ„åŠ›å¤´æ•°: 24
- æ€»å‚æ•°é‡: 8.1B

---

## 9.3 ä¸‰ç‰ˆæœ¬å®æˆ˜å¯¹æ¯”

### 9.3.1 SD 3.5 Large - æ——èˆ°è´¨é‡

**é€‚ç”¨åœºæ™¯**:
- å•†ä¸šæµ·æŠ¥è®¾è®¡
- å“ç‰Œè§†è§‰è®¾è®¡
- é«˜è´¨é‡æ’ç”»åˆ›ä½œ
- éœ€è¦ç²¾ç¡®æ–‡å­—æ¸²æŸ“çš„åœºæ™¯

**é…ç½®æ¨è**:
```yaml
ç¡¬ä»¶:
  GPU: RTX 4090 24GB / A100 40GB
  RAM: 32GB+
  å­˜å‚¨: SSD 100GB+

è½¯ä»¶:
  Python: 3.10+
  CUDA: 12.1+
  PyTorch: 2.1+
```

**ComfyUIå·¥ä½œæµ**:

```json
{
  "1": {
    "class_type": "CheckpointLoaderSimple",
    "inputs": {
      "ckpt_name": "sd3.5_large.safetensors"
    }
  },
  "2": {
    "class_type": "CLIPTextEncodeSDXL",
    "inputs": {
      "text": "A photorealistic portrait of a female athlete in a modern gym, wearing Nike sportswear, with 'JUST DO IT' text on the wall, golden hour lighting, shot on Canon EOS R5, 85mm f/1.2",
      "clip": ["1", 1]
    }
  },
  "3": {
    "class_type": "CLIPTextEncodeSDXL",
    "inputs": {
      "text": "blurry, low quality, distorted text, watermark, signature",
      "clip": ["1", 1]
    }
  },
  "4": {
    "class_type": "EmptyLatentImage",
    "inputs": {
      "width": 1024,
      "height": 1024,
      "batch_size": 1
    }
  },
  "5": {
    "class_type": "KSampler",
    "inputs": {
      "seed": 42,
      "steps": 40,
      "cfg": 7.0,
      "sampler_name": "dpmpp_2m",
      "scheduler": "karras",
      "denoise": 1.0,
      "model": ["1", 0],
      "positive": ["2", 0],
      "negative": ["3", 0],
      "latent_image": ["4", 0]
    }
  },
  "6": {
    "class_type": "VAEDecode",
    "inputs": {
      "samples": ["5", 0],
      "vae": ["1", 2]
    }
  },
  "7": {
    "class_type": "SaveImage",
    "inputs": {
      "images": ["6", 0],
      "filename_prefix": "SD35_Large"
    }
  }
}
```

**é»„é‡‘å‚æ•°ç»„åˆ**:
```python
# é€šç”¨é«˜è´¨é‡é…ç½®
LARGE_PARAMS = {
    "steps": 40,              # 40æ­¥ä¿è¯è´¨é‡
    "cfg_scale": 7.0,         # ä¸­ç­‰å¼•å¯¼å¼ºåº¦
    "sampler": "DPM++ 2M Karras",
    "resolution": "1024x1024",
    "denoise": 1.0
}

# æ–‡å­—æ¸²æŸ“ä¸“ç”¨
TEXT_RENDERING_PARAMS = {
    "steps": 50,              # æ›´å¤šæ­¥æ•°ä¿è¯æ–‡å­—æ¸…æ™°
    "cfg_scale": 8.0,         # æ›´å¼ºå¼•å¯¼
    "sampler": "Euler a",
    "prompt_tricks": [
        "æ˜ç¡®æŒ‡å®šæ–‡å­—å†…å®¹",
        "ä½¿ç”¨å¼•å·åŒ…è£¹æ–‡å­—: 'NIKE'",
        "å¼ºè°ƒ: (text on sign:1.3)"
    ]
}

# å¤æ‚æ„å›¾ä¸“ç”¨
COMPLEX_SCENE_PARAMS = {
    "steps": 50,
    "cfg_scale": 6.5,         # ç¨ä½CFGé¿å…è¿‡æ‹Ÿåˆ
    "sampler": "DPM++ SDE Karras",
    "prompt_structure": "ä¸»ä½“ + ç¯å¢ƒ + å…‰çº¿ + ç»†èŠ‚"
}
```

### 9.3.2 SD 3.5 Large Turbo - æé€Ÿç”Ÿäº§

**æ ¸å¿ƒæŠ€æœ¯: è’¸é¦å­¦ä¹  (Distillation)**

```
Teacheræ¨¡å‹ (SD 3.5 Large, 50æ­¥)
    â†“ çŸ¥è¯†è’¸é¦
Studentæ¨¡å‹ (SD 3.5 Large Turbo, 4æ­¥)
```

è’¸é¦æŸå¤±å‡½æ•°:
$$
\mathcal{L}_{\text{distill}} = \mathbb{E}_{x_0, t, c} \left[ \| \epsilon_{\text{student}}(x_t, t, c) - \epsilon_{\text{teacher}}(x_t, t, c) \|^2 \right]
$$

**æ€§èƒ½å¯¹æ¯”å®æµ‹**:
```python
# æµ‹è¯•ç¯å¢ƒ: RTX 4090 24GB
import time
from diffusers import StableDiffusion3Pipeline

# Largeç‰ˆæœ¬
pipe_large = StableDiffusion3Pipeline.from_pretrained(
    "stabilityai/stable-diffusion-3.5-large"
)
start = time.time()
image_large = pipe_large(prompt, num_inference_steps=40).images[0]
time_large = time.time() - start
# ç»“æœ: ~18.5ç§’

# Large Turboç‰ˆæœ¬
pipe_turbo = StableDiffusion3Pipeline.from_pretrained(
    "stabilityai/stable-diffusion-3.5-large-turbo"
)
start = time.time()
image_turbo = pipe_turbo(prompt, num_inference_steps=4, guidance_scale=0.0).images[0]
time_turbo = time.time() - start
# ç»“æœ: ~3.8ç§’

print(f"åŠ é€Ÿæ¯”: {time_large / time_turbo:.2f}x")  # ~4.87x
```

**è´¨é‡ vs é€Ÿåº¦æƒè¡¡**:
| æ­¥æ•° | æ—¶é—´ | è´¨é‡è¯„åˆ† | é€‚ç”¨åœºæ™¯ |
|------|------|---------|---------|
| 4æ­¥ | 3.8s | 85/100 | å¿«é€ŸåŸå‹ã€æ‰¹é‡ç”Ÿäº§ |
| 6æ­¥ | 5.2s | 90/100 | å¹³è¡¡é€‰æ‹© |
| 8æ­¥ | 6.8s | 93/100 | å‡†å•†ä¸šçº§ |

**Turboä¸“ç”¨å‚æ•°**:
```python
TURBO_PARAMS = {
    "steps": 4,                    # æ ¸å¿ƒ: 4æ­¥å³å¯
    "cfg_scale": 0.0,              # å…³é—­CFG (è’¸é¦æ¨¡å‹ä¸éœ€è¦)
    "sampler": "Euler",            # ç®€å•é‡‡æ ·å™¨
    "resolution": "1024x1024",

    # æç¤ºè¯å»ºè®®
    "prompt_length": "ä¸­ç­‰é•¿åº¦ (50-100è¯)",
    "prompt_style": "ç›´æ¥æè¿°,ä¸éœ€è¦è¿‡å¤šä¿®é¥°è¯"
}
```

**æ‰¹é‡ç”Ÿäº§è„šæœ¬**:
```python
import torch
from diffusers import StableDiffusion3Pipeline
from concurrent.futures import ThreadPoolExecutor
import pandas as pd

class SD35TurboBatchGenerator:
    def __init__(self, model_path="stabilityai/stable-diffusion-3.5-large-turbo"):
        self.pipe = StableDiffusion3Pipeline.from_pretrained(
            model_path,
            torch_dtype=torch.float16
        ).to("cuda")

        # ä¼˜åŒ–: å¯ç”¨xformers
        self.pipe.enable_xformers_memory_efficient_attention()

    def generate_single(self, prompt, seed=None):
        """å•å¼ ç”Ÿæˆ"""
        if seed:
            generator = torch.Generator("cuda").manual_seed(seed)
        else:
            generator = None

        image = self.pipe(
            prompt=prompt,
            num_inference_steps=4,
            guidance_scale=0.0,  # Turboå…³é”®: CFG=0
            generator=generator,
            width=1024,
            height=1024
        ).images[0]

        return image

    def batch_generate(self, prompts_csv, output_dir, workers=1):
        """
        æ‰¹é‡ç”Ÿæˆ
        prompts_csvæ ¼å¼:
        id,prompt,seed
        1,"A modern gym interior...",42
        2,"A fitness coach...",123
        """
        df = pd.read_csv(prompts_csv)

        for idx, row in df.iterrows():
            print(f"[{idx+1}/{len(df)}] Generating: {row['prompt'][:50]}...")

            image = self.generate_single(
                prompt=row['prompt'],
                seed=int(row['seed']) if pd.notna(row['seed']) else None
            )

            image.save(f"{output_dir}/{row['id']}.png")
            print(f"  âœ“ Saved to {output_dir}/{row['id']}.png")

# ä½¿ç”¨ç¤ºä¾‹
generator = SD35TurboBatchGenerator()
generator.batch_generate(
    prompts_csv="prompts.csv",
    output_dir="output",
    workers=1  # Turboå•å¡é€Ÿåº¦å·²ç»å¾ˆå¿«,é€šå¸¸ä¸éœ€è¦å¹¶è¡Œ
)
```

**æˆæœ¬åˆ†æ**:
```python
# æœ¬åœ°éƒ¨ç½²æˆæœ¬ (RTX 4090)
POWER_CONSUMPTION = 450  # W
ELECTRICITY_RATE = 0.12  # $/kWh
TIME_PER_IMAGE = 3.8 / 3600  # hours

cost_per_image = POWER_CONSUMPTION * TIME_PER_IMAGE * ELECTRICITY_RATE
# = 450 * (3.8/3600) * 0.12 = $0.000057

print(f"ç”Ÿæˆ1000å¼ å›¾æˆæœ¬: ${cost_per_image * 1000:.2f}")  # ~$0.06

# vs Replicate API
REPLICATE_TURBO_COST = 0.003  # $/image
print(f"Replicateç”Ÿæˆ1000å¼ æˆæœ¬: ${REPLICATE_TURBO_COST * 1000:.2f}")  # $3.00

print(f"æœ¬åœ°éƒ¨ç½²èŠ‚çœ: {(REPLICATE_TURBO_COST * 1000 - cost_per_image * 1000):.2f}")  # ~$2.94
```

### 9.3.3 SD 3.5 Medium - ä¸ªäººåˆ›ä½œé¦–é€‰

**æŠ€æœ¯äº®ç‚¹**:
- **ä»…9.9GB VRAM** (ä¸å«æ–‡æœ¬ç¼–ç å™¨)
- æ”¯æŒ**0.25MPåˆ°2MP**å¤šåˆ†è¾¨ç‡
- Query-Key Normalizationæ”¹è¿›è®­ç»ƒ

**ç¡¬ä»¶å‹å¥½é…ç½®**:
```yaml
æœ€ä½é…ç½®:
  GPU: RTX 3060 12GB
  RAM: 16GB
  é€‚ç”¨åˆ†è¾¨ç‡: 512x512 ~ 768x768

æ¨èé…ç½®:
  GPU: RTX 4060 Ti 16GB
  RAM: 32GB
  é€‚ç”¨åˆ†è¾¨ç‡: 512x512 ~ 1448x1448

æ€§èƒ½é…ç½®:
  GPU: RTX 4070 Ti 16GB
  RAM: 32GB
  é€‚ç”¨åˆ†è¾¨ç‡: å…¨åˆ†è¾¨ç‡æµç•…
```

**VRAMä¼˜åŒ–æŠ€å·§**:
```python
from diffusers import StableDiffusion3Pipeline
import torch

# æ–¹æ³•1: ä½¿ç”¨float16
pipe = StableDiffusion3Pipeline.from_pretrained(
    "stabilityai/stable-diffusion-3.5-medium",
    torch_dtype=torch.float16,  # å‡åŠVRAM
    variant="fp16"
).to("cuda")

# æ–¹æ³•2: å¯ç”¨CPU offload (è¿›ä¸€æ­¥é™ä½VRAM)
pipe.enable_model_cpu_offload()  # VRAMé™è‡³~6GB,ä½†é€Ÿåº¦å˜æ…¢

# æ–¹æ³•3: å¯ç”¨sequential CPU offload (æœ€æ¿€è¿›)
pipe.enable_sequential_cpu_offload()  # VRAMé™è‡³~4GB,é€Ÿåº¦å¤§å¹…ä¸‹é™

# æ–¹æ³•4: ä½¿ç”¨attention slicing
pipe.enable_attention_slicing(slice_size=1)  # é™ä½attention VRAM

# ç»„åˆä¼˜åŒ– (12GBå¡æœ€ä½³å®è·µ)
pipe = StableDiffusion3Pipeline.from_pretrained(
    "stabilityai/stable-diffusion-3.5-medium",
    torch_dtype=torch.float16
).to("cuda")
pipe.enable_xformers_memory_efficient_attention()  # éœ€å®‰è£…xformers
pipe.enable_attention_slicing(slice_size=1)

# ç”Ÿæˆ
image = pipe(
    prompt="A serene lake at sunset",
    num_inference_steps=30,
    width=1024,
    height=1024
).images[0]
```

**å¤šåˆ†è¾¨ç‡æœ€ä½³å®è·µ**:
```python
# SD 3.5 Mediumæ”¯æŒçš„åˆ†è¾¨ç‡
SUPPORTED_RESOLUTIONS = {
    "square": [
        (512, 512),    # 0.25MP - å¿«é€Ÿé¢„è§ˆ
        (768, 768),    # 0.6MP  - å¹³è¡¡é€‰æ‹©
        (1024, 1024),  # 1MP    - æ ‡å‡†è¾“å‡º
        (1448, 1448),  # 2MP    - é«˜è´¨é‡ (éœ€16GB+ VRAM)
    ],
    "landscape": [
        (768, 512),    # 3:2
        (1024, 768),   # 4:3
        (1024, 576),   # 16:9
        (1152, 896),   # è‡ªå®šä¹‰
    ],
    "portrait": [
        (512, 768),    # 2:3
        (768, 1024),   # 3:4
        (576, 1024),   # 9:16
        (896, 1152),   # è‡ªå®šä¹‰
    ]
}

def choose_resolution(vram_gb, quality_target):
    """åˆ†è¾¨ç‡é€‰æ‹©ç­–ç•¥"""
    if vram_gb < 12:
        return (768, 768) if quality_target == "balanced" else (512, 512)
    elif vram_gb < 16:
        return (1024, 1024)
    else:
        return (1448, 1448) if quality_target == "max" else (1024, 1024)

# ä½¿ç”¨ç¤ºä¾‹
width, height = choose_resolution(vram_gb=12, quality_target="balanced")
```

---

## 9.4 æ–‡å­—æ¸²æŸ“èƒ½åŠ›å®æˆ˜

### 9.4.1 æ–‡å­—æ¸²æŸ“æŠ€æœ¯åŸç†

**ä¸ºä»€ä¹ˆSDXLä¸èƒ½æ¸²æŸ“æ–‡å­—?**
```
SDXLçš„æ–‡æœ¬ç†è§£æµç¨‹:
æç¤ºè¯ â†’ CLIPç¼–ç  â†’ 768ç»´å‘é‡
              â†“
         "NIKE" â‰ˆ "è¿åŠ¨å“ç‰Œ" (è¯­ä¹‰)
         å…·ä½“å­—æ¯ä¿¡æ¯ä¸¢å¤±!
```

**SD 3.5çš„æ”¹è¿›**:
```
SD 3.5çš„æ–‡æœ¬ç†è§£æµç¨‹:
æç¤ºè¯ â†’ 3ç¼–ç å™¨å¹¶è¡Œ
         â”œâ”€ CLIP-L: è§†è§‰è¯­ä¹‰
         â”œâ”€ CLIP-G: ç‰©ä½“å…³ç³»
         â””â”€ T5-XXL: **å­—ç¬¦çº§ç†è§£** â† å…³é”®!
              â†“
         "NIKE" = N + I + K + E (å­—ç¬¦åºåˆ—)
         ä¿ç•™äº†å…·ä½“å­—æ¯ä¿¡æ¯!
```

### 9.4.2 æ–‡å­—æ¸²æŸ“æœ€ä½³å®è·µ

**æç¤ºè¯æ¨¡æ¿**:
```python
TEXT_RENDERING_TEMPLATES = {
    "å•†ä¸šæµ·æŠ¥": """
        A {äº§å“ç±»å‹} advertisement poster,
        prominent text "{å…·ä½“æ–‡å­—å†…å®¹}" in {å­—ä½“é£æ ¼} font,
        {èƒŒæ™¯æè¿°}, {å…‰çº¿}, {é£æ ¼},
        text is clearly legible, professional typography
        """,

    "å“ç‰ŒLogo": """
        A modern logo design featuring the text "{å“ç‰Œåç§°}",
        {è®¾è®¡é£æ ¼} style, {é¢œè‰²æ–¹æ¡ˆ},
        text "{å“ç‰Œåç§°}" is sharp and clearly readable,
        vector art style, white background
        """,

    "è¡—æ™¯æ ‡è¯†": """
        A {åœºæ™¯} scene with a {æ ‡è¯†ç±»å‹} displaying "{æ–‡å­—å†…å®¹}",
        {ç¯å¢ƒæè¿°}, {å…‰çº¿æ¡ä»¶},
        the text "{æ–‡å­—å†…å®¹}" on the {æ ‡è¯†ç±»å‹} is crisp and legible,
        {æ‘„å½±é£æ ¼}
        """,

    "äº§å“åŒ…è£…": """
        A {äº§å“} product shot, packaging shows "{äº§å“å}" text,
        {åŒ…è£…æè´¨}, {èƒŒæ™¯}, {å…‰çº¿},
        product name "{äº§å“å}" is clearly visible and sharp,
        commercial photography, 8K resolution
        """
}

# ä½¿ç”¨ç¤ºä¾‹
prompt = TEXT_RENDERING_TEMPLATES["å•†ä¸šæµ·æŠ¥"].format(
    äº§å“ç±»å‹="fitness supplement",
    å…·ä½“æ–‡å­—å†…å®¹="PROTEIN PRO",
    å­—ä½“é£æ ¼="bold sans-serif",
    èƒŒæ™¯æè¿°="gym environment with dumbbells",
    å…‰çº¿="dramatic side lighting",
    é£æ ¼="modern commercial photography"
)
```

**å…³é”®æŠ€å·§**:
1. **æ˜ç¡®æ–‡å­—å†…å®¹**: ç”¨å¼•å·åŒ…è£¹ `"EXACT TEXT"`
2. **é‡å¤å¼ºè°ƒ**: åœ¨æç¤ºè¯å¤šå¤„æåŠç›¸åŒæ–‡å­—
3. **å­—ä½“æè¿°**: æŒ‡å®šå­—ä½“é£æ ¼ (bold/serif/handwrittenç­‰)
4. **å¯è¯»æ€§å¼ºè°ƒ**: æ·»åŠ  "clearly legible", "sharp text", "readable"
5. **æƒé‡å¢å¼º**: `(text "NIKE":1.3)` æˆ– `("NIKE" text on sign:1.4)`

**å®æˆ˜æ¡ˆä¾‹**:

```python
from diffusers import StableDiffusion3Pipeline
import torch

pipe = StableDiffusion3Pipeline.from_pretrained(
    "stabilityai/stable-diffusion-3.5-large",
    torch_dtype=torch.float16
).to("cuda")

# æ¡ˆä¾‹1: å¥èº«æˆ¿å¢™é¢æ ‡è¯­
prompt_gym = """
A modern fitness gym interior,
large motivational text "NO PAIN NO GAIN" painted on the concrete wall in bold uppercase letters,
industrial style, dramatic lighting from large windows,
the text "NO PAIN NO GAIN" is clearly legible and professionally painted,
photorealistic, shot on Canon EOS R5, 24mm wide angle
"""

negative_prompt = "blurry text, unreadable letters, distorted words, low quality"

image_gym = pipe(
    prompt=prompt_gym,
    negative_prompt=negative_prompt,
    num_inference_steps=50,  # æ›´å¤šæ­¥æ•°ä¿è¯æ–‡å­—æ¸…æ™°
    guidance_scale=8.0,      # æ›´å¼ºå¼•å¯¼
    width=1024,
    height=1024
).images[0]

image_gym.save("gym_text_rendering.png")

# æ¡ˆä¾‹2: äº§å“Logoè®¾è®¡
prompt_logo = """
A minimalist logo design for a fitness brand,
text "FITPRO" in modern geometric sans-serif font,
navy blue and orange color scheme, abstract dumbbell icon,
the brand name "FITPRO" is sharp and perfectly readable,
vector art style, clean lines, white background,
professional brand identity design
"""

image_logo = pipe(
    prompt=prompt_logo,
    negative_prompt="blurry, low resolution, distorted text",
    num_inference_steps=50,
    guidance_scale=7.5,
    width=1024,
    height=1024
).images[0]

image_logo.save("fitpro_logo.png")
```

### 9.4.3 æ–‡å­—æ¸²æŸ“æˆåŠŸç‡åˆ†æ

```python
# åŸºäºå®æµ‹æ•°æ®çš„æˆåŠŸç‡ç»Ÿè®¡
TEXT_RENDERING_SUCCESS_RATE = {
    "SDXL": {
        "ç®€å•è‹±æ–‡å•è¯ (3-5å­—æ¯)": 15,   # %
        "çŸ­å¥ (2-3å•è¯)": 5,
        "é•¿å¥ (4+å•è¯)": 0,
        "ä¸­æ–‡": 0
    },
    "SD 3.5 Large": {
        "ç®€å•è‹±æ–‡å•è¯ (3-5å­—æ¯)": 85,
        "çŸ­å¥ (2-3å•è¯)": 70,
        "é•¿å¥ (4+å•è¯)": 45,
        "ä¸­æ–‡": 10  # ä»ä¸ç†æƒ³
    },
    "Flux.1 Dev": {
        "ç®€å•è‹±æ–‡å•è¯ (3-5å­—æ¯)": 95,
        "çŸ­å¥ (2-3å•è¯)": 90,
        "é•¿å¥ (4+å•è¯)": 75,
        "ä¸­æ–‡": 30  # ç•¥å¥½ä½†ä»æœ‰é™
    }
}
```

**å»ºè®®**:
- è‹±æ–‡æ–‡å­—: SD 3.5 Large å®Œå…¨å¤Ÿç”¨
- ä¸­æ–‡æ–‡å­—: å»ºè®®ä½¿ç”¨ä¸“é—¨å·¥å…·æˆ–åæœŸPS

---

## 9.5 å•†ä¸šæˆæƒä¸æˆæœ¬åˆ†æ

### 9.5.1 Stability AI Community Licenseè¯¦è§£

**è®¸å¯è¯æ¡æ¬¾** (æˆªè‡³2025å¹´):

```yaml
âœ… å…è´¹ä½¿ç”¨åœºæ™¯:
  - ä¸ªäººéå•†ä¸šåˆ›ä½œ: âœ“
  - ç§‘å­¦ç ”ç©¶: âœ“
  - å¹´è¥æ”¶ < $1M çš„å•†ä¸šä½¿ç”¨: âœ“
  - æ•™è‚²ç”¨é€”: âœ“

ğŸ“ å…è´¹å•†ç”¨è¦æ±‚ (<$1Mè¥æ”¶):
  - ä¿ç•™ç”Ÿæˆå›¾ç‰‡çš„æ‰€æœ‰æƒ
  - æ— éœ€æ”¯ä»˜è®¸å¯è´¹
  - éœ€éµå®ˆåŸºæœ¬ä½¿ç”¨æ¡æ¬¾ (ç¦æ­¢éæ³•å†…å®¹ç­‰)

ğŸ’° ä»˜è´¹è®¸å¯ (>=$1Mè¥æ”¶):
  - éœ€è”ç³»Stability AIè´­ä¹°ä¼ä¸šæˆæƒ
  - ä»·æ ¼: éœ€å•†åŠ¡æ´½è°ˆ
  - ä¼˜åŠ¿:
    - ä¸“å±æŠ€æœ¯æ”¯æŒ
    - å¯èƒ½çš„å®šåˆ¶åŒ–è®­ç»ƒ
    - ä¼˜å…ˆè·å–æ–°åŠŸèƒ½

âŒ ç¦æ­¢äº‹é¡¹:
  - ç”Ÿæˆéæ³•/æœ‰å®³å†…å®¹
  - ç”¨äºæ­§è§†æ€§ç”¨é€”
  - ä¾µçŠ¯ä»–äººç‰ˆæƒ/è‚–åƒæƒ
```

**vs ç«å“æˆæƒå¯¹æ¯”**:

| æ¨¡å‹ | ä¸ªäººä½¿ç”¨ | å•†ä¸šä½¿ç”¨ (<$1M) | å•†ä¸šä½¿ç”¨ (>$1M) | å¼€æºç¨‹åº¦ |
|------|---------|----------------|----------------|---------|
| **SD 3.5** | âœ… å…è´¹ | âœ… å…è´¹ | ğŸ’° ä¼ä¸šæˆæƒ | â­â­â­â­ (æƒé‡å¼€æº) |
| SDXL | âœ… å…è´¹ | âœ… å…è´¹ | âœ… å…è´¹ | â­â­â­â­â­ (å®Œå…¨å¼€æº) |
| Flux.1 Dev | âœ… å…è´¹ | âŒ éœ€ä»˜è´¹ | âŒ éœ€ä»˜è´¹ | â­â­ (æƒé‡å¼€æºä½†å•†ç”¨å—é™) |
| DALL-E 3 | âœ… ä»˜è´¹API | âœ… ä»˜è´¹API | âœ… ä»˜è´¹API | â­ (é—­æº) |
| Midjourney | âŒ è®¢é˜…åˆ¶ | âœ… è®¢é˜…å³å¯ | âœ… è®¢é˜…å³å¯ | â­ (é—­æº) |

### 9.5.2 æˆæœ¬åˆ†æ

**æœ¬åœ°éƒ¨ç½²æˆæœ¬**:

```python
# ç¡¬ä»¶æŠ•èµ„ (ä¸€æ¬¡æ€§)
HARDWARE_COST = {
    "SD 3.5 Medium": {
        "GPU": ("RTX 4060 Ti 16GB", 500),
        "å…¶ä»–ç¡¬ä»¶": 1000,  # CPU/RAM/SSDç­‰
        "æ€»æŠ•èµ„": 1500,
        "æœˆå‡æ‘Šé”€": 1500 / 24  # 2å¹´æ‘Šé”€
    },
    "SD 3.5 Large/Turbo": {
        "GPU": ("RTX 4090 24GB", 1600),
        "å…¶ä»–ç¡¬ä»¶": 1500,
        "æ€»æŠ•èµ„": 3100,
        "æœˆå‡æ‘Šé”€": 3100 / 24
    }
}

# è¿è¥æˆæœ¬ (æ¯æœˆ)
OPERATING_COST = {
    "ç”µè´¹": {
        "Medium (12GBå¡)": 20,   # å‡è®¾æ¯å¤©8å°æ—¶,ç”µä»·$0.12/kWh
        "Large (24GBå¡)": 35
    },
    "ç½‘ç»œ/å­˜å‚¨": 10,
    "ç»´æŠ¤": 5
}

# æœˆæ€»æˆæœ¬ (Mediumæ–¹æ¡ˆ)
monthly_cost_medium = HARDWARE_COST["SD 3.5 Medium"]["æœˆå‡æ‘Šé”€"] + OPERATING_COST["ç”µè´¹"]["Medium (12GBå¡)"] + OPERATING_COST["ç½‘ç»œ/å­˜å‚¨"] + OPERATING_COST["ç»´æŠ¤"]
# = 62.5 + 20 + 10 + 5 = $97.5/æœˆ

# å‡è®¾æœˆç”Ÿæˆ5000å¼ å›¾
cost_per_image_local = monthly_cost_medium / 5000
# = $0.0195/å¼ 

print(f"æœ¬åœ°éƒ¨ç½²æˆæœ¬: ${cost_per_image_local:.4f}/å¼ ")
```

**APIè°ƒç”¨æˆæœ¬ (Replicate)**:

```python
REPLICATE_PRICING = {
    "SD 3.5 Medium": 0.003,      # $/image
    "SD 3.5 Large": 0.0065,      # $/image
    "SD 3.5 Large Turbo": 0.003  # $/image
}

# æœˆç”Ÿæˆ5000å¼  (ä½¿ç”¨Large Turbo)
monthly_cost_api = 5000 * REPLICATE_PRICING["SD 3.5 Large Turbo"]
# = $15/æœˆ

print(f"APIè°ƒç”¨æˆæœ¬: ${REPLICATE_PRICING['SD 3.5 Large Turbo']:.4f}/å¼ ")
```

**ROIåˆ†æ**:

```python
def calculate_roi(monthly_volume):
    """
    è®¡ç®—æœ¬åœ°éƒ¨ç½² vs APIè°ƒç”¨çš„ROI
    monthly_volume: æ¯æœˆç”Ÿæˆå›¾ç‰‡æ•°é‡
    """
    # æœ¬åœ°éƒ¨ç½² (Mediumæ–¹æ¡ˆ)
    local_initial_cost = 1500  # åˆå§‹æŠ•èµ„
    local_monthly_cost = 97.5  # æœˆè¿è¥æˆæœ¬

    # APIè°ƒç”¨ (Large Turbo)
    api_monthly_cost = monthly_volume * 0.003

    # è®¡ç®—å›æœ¬æ—¶é—´
    monthly_savings = api_monthly_cost - local_monthly_cost

    if monthly_savings > 0:
        payback_months = local_initial_cost / monthly_savings
        print(f"\næœˆç”Ÿæˆé‡: {monthly_volume}å¼ ")
        print(f"APIæœˆæˆæœ¬: ${api_monthly_cost:.2f}")
        print(f"æœ¬åœ°æœˆæˆæœ¬: ${local_monthly_cost:.2f}")
        print(f"æœˆèŠ‚çœ: ${monthly_savings:.2f}")
        print(f"å›æœ¬æ—¶é—´: {payback_months:.1f}ä¸ªæœˆ")
    else:
        print(f"\næœˆç”Ÿæˆé‡: {monthly_volume}å¼ æ—¶,APIæ›´åˆ’ç®—")

# ä¸åŒè§„æ¨¡å¯¹æ¯”
calculate_roi(1000)   # å°è§„æ¨¡
calculate_roi(5000)   # ä¸­è§„æ¨¡
calculate_roi(10000)  # å¤§è§„æ¨¡

"""
è¾“å‡º:
æœˆç”Ÿæˆé‡: 1000å¼ 
APIæœˆæˆæœ¬: $3.00
æœ¬åœ°æœˆæˆæœ¬: $97.50
æœˆèŠ‚çœ: -$94.50
æœˆç”Ÿæˆé‡: 1000å¼ æ—¶,APIæ›´åˆ’ç®—

æœˆç”Ÿæˆé‡: 5000å¼ 
APIæœˆæˆæœ¬: $15.00
æœ¬åœ°æœˆæˆæœ¬: $97.50
æœˆèŠ‚çœ: -$82.50
æœˆç”Ÿæˆé‡: 5000å¼ æ—¶,APIæ›´åˆ’ç®—

æœˆç”Ÿæˆé‡: 10000å¼ 
APIæœˆæˆæœ¬: $30.00
æœ¬åœ°æœˆæˆæœ¬: $97.50
æœˆèŠ‚çœ: -$67.50
æœˆç”Ÿæˆé‡: 10000å¼ æ—¶,APIæ›´åˆ’ç®—

ç»“è®º: å¯¹äºSD 3.5 Large Turbo,ç”±äºAPIå®šä»·æä½($0.003/å¼ ),
      é™¤éæœˆç”Ÿæˆé‡ > 32500å¼ ,å¦åˆ™APIæ›´åˆ’ç®—!
"""
```

**é€‰å‹å»ºè®®**:

```python
def recommend_deployment(monthly_volume, budget, technical_skill):
    """
    éƒ¨ç½²æ–¹å¼æ¨è
    """
    if monthly_volume < 30000:
        return {
            "æ¨è": "Replicate API (SD 3.5 Large Turbo)",
            "ç†ç”±": "æˆæœ¬ä½,æ— éœ€ç»´æŠ¤,æŒ‰éœ€ä»˜è´¹",
            "æœˆæˆæœ¬": f"${monthly_volume * 0.003:.2f}"
        }
    elif monthly_volume < 100000:
        if budget > 3000 and technical_skill == "é«˜":
            return {
                "æ¨è": "æœ¬åœ°éƒ¨ç½² (SD 3.5 Medium)",
                "ç†ç”±": "è§„æ¨¡åŒ–åæˆæœ¬ä¼˜åŠ¿æ˜æ˜¾,æ•°æ®éšç§æ›´å¥½",
                "åˆå§‹æŠ•èµ„": "$1500",
                "æœˆè¿è¥æˆæœ¬": "$97.5"
            }
        else:
            return {
                "æ¨è": "æ··åˆæ–¹æ¡ˆ",
                "ç†ç”±": "é«˜å³°æœŸAPI,æ—¥å¸¸ç”¨æœ¬åœ°",
                "é…ç½®": "æœ¬åœ°Medium + Replicateå¤‡ç”¨"
            }
    else:
        return {
            "æ¨è": "æœ¬åœ°é›†ç¾¤éƒ¨ç½²",
            "ç†ç”±": "è¶…å¤§è§„æ¨¡å¿…é¡»æœ¬åœ°åŒ–",
            "é…ç½®": "å¤šå¡å¹¶è¡Œ + è´Ÿè½½å‡è¡¡"
        }
```

---

## 9.6 å®æˆ˜æ¡ˆä¾‹: Logoè®¾è®¡

### 9.6.1 éœ€æ±‚åˆ†æ

**é¡¹ç›®ç›®æ ‡**: ä¸ºå¥èº«å“ç‰Œ"FITPRO"è®¾è®¡Logo
**è¦æ±‚**:
- å“ç‰Œå"FITPRO"æ¸…æ™°å¯è¯»
- ç°ä»£ã€ä¸“ä¸šã€è¿åŠ¨æ„Ÿ
- è“è‰²+æ©™è‰²é…è‰²
- å¯ç”¨äºäº§å“åŒ…è£…å’Œç½‘ç«™

### 9.6.2 æç¤ºè¯è®¾è®¡

```python
# å¤šç‰ˆæœ¬å¯¹æ¯”ç”Ÿæˆ
LOGO_PROMPTS = {
    "ç‰ˆæœ¬A_æç®€é£æ ¼": """
        A minimalist fitness brand logo design,
        text "FITPRO" in bold geometric sans-serif uppercase letters,
        navy blue (#1E3A8A) and vibrant orange (#F97316) color scheme,
        abstract dumbbell icon integrated with the letter 'F',
        the brand name "FITPRO" is sharp, perfectly readable and professionally spaced,
        modern vector art style, clean lines, flat design,
        white background, professional brand identity,
        high contrast, suitable for print and digital use
        """,

    "ç‰ˆæœ¬B_åŠ¨æ„Ÿé£æ ¼": """
        A dynamic fitness logo featuring "FITPRO" text,
        bold italic font suggesting forward motion,
        gradient from navy blue to bright orange,
        stylized swoosh element behind the text,
        "FITPRO" lettering is crisp and clearly legible,
        energetic and sporty aesthetic,
        vector graphics, white background,
        suitable for athletic apparel and marketing materials
        """,

    "ç‰ˆæœ¬C_å¾½ç« é£æ ¼": """
        A circular badge-style fitness logo,
        "FITPRO" text prominently displayed in strong uppercase letters,
        navy blue outer ring with orange inner circle,
        minimalist barbell icon at center,
        brand name "FITPRO" is bold and highly readable,
        classic emblem design with modern twist,
        vector art, flat colors, white background,
        professional gym branding style
        """
}
```

### 9.6.3 ç”Ÿæˆä¸è¿­ä»£

```python
from diffusers import StableDiffusion3Pipeline
import torch
from PIL import Image

pipe = StableDiffusion3Pipeline.from_pretrained(
    "stabilityai/stable-diffusion-3.5-large",
    torch_dtype=torch.float16
).to("cuda")

negative_prompt = """
blurry text, unreadable letters, distorted words, pixelated,
low quality, watermark, signature, multiple logos,
cluttered design, poor typography, Comic Sans font
"""

def generate_logo_variations(prompt_dict, seeds=[42, 123, 456]):
    """ç”Ÿæˆå¤šä¸ªseedçš„å˜ä½“"""
    results = {}

    for version_name, prompt in prompt_dict.items():
        print(f"\nç”Ÿæˆ {version_name}...")
        version_results = []

        for seed in seeds:
            generator = torch.Generator("cuda").manual_seed(seed)

            image = pipe(
                prompt=prompt,
                negative_prompt=negative_prompt,
                num_inference_steps=50,  # é«˜è´¨é‡
                guidance_scale=8.0,      # å¼ºå¼•å¯¼ä¿è¯æ–‡å­—å‡†ç¡®
                generator=generator,
                width=1024,
                height=1024
            ).images[0]

            version_results.append(image)
            image.save(f"logo_{version_name}_seed{seed}.png")
            print(f"  âœ“ Seed {seed} å·²ä¿å­˜")

        results[version_name] = version_results

    return results

# ç”Ÿæˆæ‰€æœ‰ç‰ˆæœ¬
all_logos = generate_logo_variations(LOGO_PROMPTS)

# åˆ›å»ºå¯¹æ¯”å›¾
def create_comparison_grid(results, output_path="logo_comparison.png"):
    """åˆ›å»ºå¯¹æ¯”ç½‘æ ¼"""
    versions = list(results.keys())
    seeds_count = len(results[versions[0]])

    # è®¡ç®—ç½‘æ ¼å°ºå¯¸
    grid_width = seeds_count * 1024
    grid_height = len(versions) * 1024

    grid = Image.new('RGB', (grid_width, grid_height), 'white')

    for v_idx, version in enumerate(versions):
        for s_idx, img in enumerate(results[version]):
            grid.paste(img, (s_idx * 1024, v_idx * 1024))

    grid.save(output_path)
    print(f"\nå¯¹æ¯”å›¾å·²ä¿å­˜: {output_path}")

create_comparison_grid(all_logos)
```

### 9.6.4 åæœŸä¼˜åŒ–

è™½ç„¶SD 3.5æ–‡å­—æ¸²æŸ“èƒ½åŠ›å¼º,ä½†å•†ä¸šLogoä»å»ºè®®:

1. **AIç”Ÿæˆåˆç¨¿** â†’ SD 3.5å¿«é€Ÿç”Ÿæˆå¤šä¸ªæ–¹å‘
2. **äººå·¥ç­›é€‰** â†’ é€‰å‡ºæœ€ä½³1-2ä¸ª
3. **ä¸“ä¸šä¿®å›¾** â†’ Photoshopç²¾ä¿®æ–‡å­—å’Œç»†èŠ‚
4. **çŸ¢é‡åŒ–** â†’ Illustratorè½¬ä¸ºçŸ¢é‡æ ¼å¼

**å·¥ä½œæµ**:
```
SD 3.5ç”Ÿæˆ (30åˆ†é’Ÿ,ç”Ÿæˆ50+æ–¹æ¡ˆ)
    â†“
åˆæ­¥ç­›é€‰ (10åˆ†é’Ÿ,é€‰å‡º5ä¸ª)
    â†“
AIæ”¾å¤§ (upscale to 2K, 5åˆ†é’Ÿ)
    â†“
PSç²¾ä¿®æ–‡å­— (30åˆ†é’Ÿ)
    â†“
AIè½¬çŸ¢é‡ (20åˆ†é’Ÿ)
    â†“
æœ€ç»ˆäº¤ä»˜ (SVG/EPS/PNG)

æ€»è€—æ—¶: ~1.5å°æ—¶ (ä¼ ç»Ÿæ–¹å¼éœ€1-2å¤©)
```

---

## 9.7 å¸¸è§é—®é¢˜ä¸æ’æŸ¥

### 9.7.1 æ–‡å­—æ¸²æŸ“å¤±è´¥

**é—®é¢˜**: ç”Ÿæˆçš„æ–‡å­—æ¨¡ç³Š/é”™è¯¯/ä¹±ç 

**æ’æŸ¥æ­¥éª¤**:
1. **æ£€æŸ¥æç¤ºè¯**
   ```python
   âŒ é”™è¯¯: "gym with sign"  # æ²¡è¯´å…·ä½“æ–‡å­—
   âœ… æ­£ç¡®: 'gym with "NO PAIN NO GAIN" sign clearly visible'
   ```

2. **å¢åŠ steps**
   ```python
   steps = 50  # ä»30å¢åŠ åˆ°50
   cfg_scale = 8.0  # ä»7.0å¢åŠ åˆ°8.0
   ```

3. **ä½¿ç”¨Largeç‰ˆæœ¬**
   ```python
   # Mediumçš„æ–‡å­—èƒ½åŠ› < Large
   pipe = StableDiffusion3Pipeline.from_pretrained(
       "stabilityai/stable-diffusion-3.5-large"  # ä¸è¦ç”¨medium
   )
   ```

4. **ç®€åŒ–æ–‡å­—å†…å®¹**
   ```python
   âŒ "Welcome to FitPro Elite Fitness Center"  # å¤ªé•¿
   âœ… "FITPRO"  # çŸ­å°ç²¾æ‚
   ```

### 9.7.2 VRAMä¸è¶³

**é”™è¯¯ä¿¡æ¯**: `CUDA out of memory`

**è§£å†³æ–¹æ¡ˆ**:

```python
# æ–¹æ¡ˆ1: é™ä½åˆ†è¾¨ç‡
width, height = 768, 768  # ä»1024é™åˆ°768

# æ–¹æ¡ˆ2: ä½¿ç”¨Mediumç‰ˆæœ¬
pipe = StableDiffusion3Pipeline.from_pretrained(
    "stabilityai/stable-diffusion-3.5-medium"  # 9.9GB vs 15GB
)

# æ–¹æ¡ˆ3: å¯ç”¨CPU offload
pipe.enable_model_cpu_offload()

# æ–¹æ¡ˆ4: ä½¿ç”¨float16 + xformers
pipe = StableDiffusion3Pipeline.from_pretrained(
    model_path,
    torch_dtype=torch.float16
).to("cuda")
pipe.enable_xformers_memory_efficient_attention()

# æ–¹æ¡ˆ5: æ¸…ç†VRAM
import gc
gc.collect()
torch.cuda.empty_cache()
```

### 9.7.3 ç”Ÿæˆé€Ÿåº¦æ…¢

**é—®é¢˜**: Largeç‰ˆæœ¬ç”Ÿæˆä¸€å¼ å›¾éœ€20ç§’+

**ä¼˜åŒ–æ–¹æ³•**:

```python
# æ–¹æ³•1: æ¢ç”¨Turboç‰ˆæœ¬
pipe = StableDiffusion3Pipeline.from_pretrained(
    "stabilityai/stable-diffusion-3.5-large-turbo"
)
# 4æ­¥ç”Ÿæˆ,é€Ÿåº¦æå‡5å€

# æ–¹æ³•2: å¯ç”¨xformers
pipe.enable_xformers_memory_efficient_attention()
# é€Ÿåº¦æå‡15-20%

# æ–¹æ³•3: ç¼–è¯‘æ¨¡å‹ (PyTorch 2.0+)
pipe.unet = torch.compile(pipe.unet, mode="reduce-overhead")
# é¦–æ¬¡æ…¢,åç»­å¿«30%

# æ–¹æ³•4: ä½¿ç”¨TensorRT (é«˜çº§)
# éœ€è¦å•ç‹¬å®‰è£…nvidia-tensorrt
# é€Ÿåº¦å¯æå‡2-3å€
```

### 9.7.4 è¾“å‡ºå¤šæ ·æ€§è¿‡é«˜

**é—®é¢˜**: ç›¸åŒæç¤ºè¯æ¯æ¬¡ç”Ÿæˆç»“æœå·®å¼‚å¾ˆå¤§

**è¯´æ˜**: è¿™æ˜¯SD 3.5çš„è®¾è®¡ç‰¹æ€§,ä¿ç•™æ›´å¹¿æ³›çš„çŸ¥è¯†åº“

**æ§åˆ¶æ–¹æ³•**:

```python
# æ–¹æ³•1: å›ºå®šseed
generator = torch.Generator("cuda").manual_seed(42)

# æ–¹æ³•2: æ›´è¯¦ç»†çš„æç¤ºè¯
prompt = """
A photorealistic portrait,  # å…·ä½“é£æ ¼
30-year-old Asian female,   # å…·ä½“ç‰¹å¾
wearing white Nike t-shirt, # å…·ä½“æœè£…
modern gym background,       # å…·ä½“ç¯å¢ƒ
soft natural lighting,       # å…·ä½“å…‰çº¿
shot on Canon EOS R5 85mm f/1.2,  # å…·ä½“å™¨æ
shallow depth of field       # å…·ä½“æ•ˆæœ
"""

# æ–¹æ³•3: æé«˜CFG Scale
cfg_scale = 9.0  # ä»7.0æé«˜åˆ°9.0,æ›´ä¸¥æ ¼éµå¾ªæç¤ºè¯

# æ–¹æ³•4: ä½¿ç”¨å‚è€ƒå›¾ (éœ€ControlNet/IP-Adapter)
```

---

## 9.8 æ€»ç»“ä¸å±•æœ›

### 9.8.1 SD 3.5æ ¸å¿ƒä¼˜åŠ¿

âœ… **æŠ€æœ¯åˆ›æ–°**: MMDiT-Xæ¶æ„ + QK Normalization
âœ… **å•†ä¸šå‹å¥½**: <$1Mè¥æ”¶å…è´¹å•†ç”¨
âœ… **æ–‡å­—æ¸²æŸ“**: è‹±æ–‡æ–‡å­—ç”Ÿæˆèƒ½åŠ›é¢†å…ˆ
âœ… **ä¸‰ç‰ˆæœ¬è¦†ç›–**: ä»ä¸ªäººåˆ°ä¼ä¸šçš„å®Œæ•´è§£å†³æ–¹æ¡ˆ
âœ… **è´¨é‡æå‡**: æç¤ºè¯ç†è§£å’Œå¤æ‚æ„å›¾ä¼˜äºSDXL

### 9.8.2 å½“å‰å±€é™

âŒ ç¤¾åŒºç”Ÿæ€ä¸å¦‚SDXLæˆç†Ÿ (LoRA/Checkpointè¾ƒå°‘)
âŒ ä¸­æ–‡æ–‡å­—æ¸²æŸ“ä»ä¸ç†æƒ³
âŒ Largeç‰ˆæœ¬ç¡¬ä»¶è¦æ±‚è¾ƒé«˜
âŒ ç”Ÿæˆé€Ÿåº¦ä¸å¦‚Flux.1 Schnell

### 9.8.3 é€‰å‹å»ºè®®

```python
def choose_model_for_project(requirements):
    """å›¾åƒç”Ÿæˆæ¨¡å‹é€‰å‹"""

    if requirements["éœ€è¦æ–‡å­—æ¸²æŸ“"] == "è‹±æ–‡":
        if requirements["é¢„ç®—"] == "å……è¶³":
            return "SD 3.5 Large (è´¨é‡æœ€ä½³)"
        else:
            return "SD 3.5 Large Turbo (é€Ÿåº¦å¿«,æˆæœ¬ä½)"

    elif requirements["éœ€è¦æ–‡å­—æ¸²æŸ“"] == "ä¸­æ–‡":
        return "Flux.1 Dev (ä¸­æ–‡ç•¥å¥½) + åæœŸPS"

    elif requirements["éœ€è¦å¤§é‡LoRA/Checkpoint"]:
        return "SDXL (ç”Ÿæ€æœ€æˆç†Ÿ)"

    elif requirements["ç¡¬ä»¶"] == "12GBä»¥ä¸‹":
        return "SD 3.5 Medium æˆ– SDXL"

    elif requirements["è¿½æ±‚æè‡´è´¨é‡"]:
        return "Flux.1 Dev (éœ€24GB VRAM)"

    else:
        return "SD 3.5 Large Turbo (ç»¼åˆæ€§ä»·æ¯”æœ€é«˜)"
```

### 9.8.4 æœªæ¥å‘å±•

**çŸ­æœŸ (3-6ä¸ªæœˆ)**:
- SD 3.5 ControlNetå‘å¸ƒ
- ç¤¾åŒºLoRA/Checkpointå¢å¤š
- APIä»·æ ¼å¯èƒ½é™ä½

**ä¸­æœŸ (6-12ä¸ªæœˆ)**:
- SD 4.0å¯èƒ½å‘å¸ƒ
- ä¸­æ–‡æ–‡å­—æ¸²æŸ“æ”¹è¿›
- æ›´æ¿€è¿›çš„è’¸é¦ç‰ˆæœ¬ (2æ­¥ç”Ÿæˆ?)

**é•¿æœŸè¶‹åŠ¿**:
- å¤šæ¨¡æ€èåˆ (å›¾+æ–‡+è§†é¢‘ç»Ÿä¸€æ¨¡å‹)
- æ›´ä½çš„ç¡¬ä»¶è¦æ±‚
- å®æ—¶ç”Ÿæˆ (60fpsè§†é¢‘?)

---

## 9.9 å®æˆ˜ç»ƒä¹ 

### ç»ƒä¹ 1: ä¸‰ç‰ˆæœ¬å¯¹æ¯”æµ‹è¯•
1. ä½¿ç”¨ç›¸åŒæç¤ºè¯åœ¨Large/Turbo/Mediumä¸Šç”Ÿæˆ
2. è®°å½•ç”Ÿæˆæ—¶é—´ã€VRAMä½¿ç”¨ã€è´¨é‡è¯„åˆ†
3. åˆ†æå„ç‰ˆæœ¬é€‚ç”¨åœºæ™¯

### ç»ƒä¹ 2: æ–‡å­—æ¸²æŸ“æŒ‘æˆ˜
1. è®¾è®¡5ä¸ªåŒ…å«æ–‡å­—çš„å•†ä¸šåœºæ™¯æç¤ºè¯
2. æµ‹è¯•æ–‡å­—æ¸²æŸ“æˆåŠŸç‡
3. æ€»ç»“æç¤ºè¯ä¼˜åŒ–æŠ€å·§

### ç»ƒä¹ 3: æˆæœ¬åˆ†æ
1. è®¡ç®—ä½ çš„é¡¹ç›®æœˆç”Ÿæˆé‡
2. å¯¹æ¯”æœ¬åœ° vs APIæˆæœ¬
3. åˆ¶å®šéƒ¨ç½²æ–¹æ¡ˆ

### ç»ƒä¹ 4: Logoè®¾è®¡é¡¹ç›®
1. ä¸ºè™šæ„å“ç‰Œè®¾è®¡Logo
2. ç”Ÿæˆè‡³å°‘3ç§é£æ ¼
3. é€‰æ‹©æœ€ä½³æ–¹æ¡ˆå¹¶åæœŸä¼˜åŒ–

---

## å‚è€ƒèµ„æº

- [Stability AIå®˜æ–¹åšå®¢ - SD 3.5å‘å¸ƒ](https://stability.ai/news/introducing-stable-diffusion-3-5)
- [Hugging Face - SD 3.5æ¨¡å‹](https://huggingface.co/stabilityai/stable-diffusion-3.5-large)
- [SD 3.5 Community License](https://stability.ai/license)
- [ComfyUI SD 3.5å·¥ä½œæµåˆ†äº«](https://comfyanonymous.github.io/ComfyUI_examples/sd3/)

**ä¸‹ä¸€ç« é¢„å‘Š**: ç¬¬10ç« å°†æ·±å…¥DALL-E 3çš„APIç²¾é€š,å­¦ä¹ OpenAIçš„é—­æºæ–¹æ¡ˆå¦‚ä½•å®ç°å•†ä¸šçº§å›¾åƒç”Ÿæˆã€‚
